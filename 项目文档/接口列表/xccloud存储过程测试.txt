********************************************************************会员*****************************************************************
-----------------------------------------------------------------------------------------------------------------------------------------
select dbo.F_GetDiscountRecordByMerchId('100025',9,'2018-05-01','2018-05-31')
select dbo.F_GetDiscountRecordByStoreId('100025','100025420106001',9,'2018-05-01','2018-05-31')
select dbo.F_GetDiscountRecordByMember('100025','100025420106001',9,'2018-05-01','2018-05-31')
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取会员卡等级
exec GetMemberLevel '100025420106001'
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取会员开卡套餐信息列表
exec GetMemberOpenCardFood '100025420106001',22
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
declare @StoreId varchar(15)
declare @OrderFlwId varchar(32)
declare @CustomerType int
declare @ICCardId int
declare @PayCount decimal(18,2)
declare @RealPay decimal(18,2)
declare @FreePay decimal(18,2)
declare @FoodCount int
declare @DetailsGoodsCount int
declare @MemberLevelId int
declare @MemberLevelName varchar(200)
declare @OpenFee decimal(18,2)
declare @Deposit decimal(18,2)
declare @RenewFee decimal(18,2)
declare @ChangeFee decimal(18,2)
exec [GetOrderContainById] '100025420106001','10002542010600120180514000120001',@CustomerType output,@ICCardId output,@PayCount output,@RealPay output,@FreePay output,
@FoodCount output,@DetailsGoodsCount output,@MemberLevelId output,@MemberLevelName output,@OpenFee output,@Deposit output,@RenewFee output,@ChangeFee output
print @MemberLevelName
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
declare @FoodDetail [FoodDetailType]
insert into @FoodDetail(FoodId,PayType) values(129,4)
insert into @FoodDetail(FoodId,PayType) values(136,3)
declare @ErrMsg varchar(200)
declare @CheckExistEffectiveOpenCardFood int
declare @OpenCardFoodId int
exec @CheckExistEffectiveOpenCardFood = CheckExistEffectiveOpenCardFood '100025420106001',22,@FoodDetail,@OpenCardFoodId output,@ErrMsg output
print '@CheckExistEffectiveOpenCardFood:' + cast(@CheckExistEffectiveOpenCardFood as varchar)
print '@OpenCardFoodId:' + cast(@OpenCardFoodId as varchar)
print '@ErrMsg:' + @ErrMsg
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取会员开卡套餐信息
declare @Result int
declare @ErrMsg varchar(200)
exec [GetMemberOpenCardFoodInfo] '100025420106001',22,@Result output,@ErrMsg output
print @Result
print @ErrMsg
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--检查会员级别
declare @RS int = 0
declare @Result int
declare @ErrMsg varchar(200)
exec @RS = CheckMemberLevel '100025420106001',21,@ErrMsg output
print @RS
print @ErrMsg
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取套餐信息
declare @StoreId varchar(15) = '100025420106001'
exec GetFoodListInfo @StoreId,2,1,'0,2,3,4,5,6'
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取会员信息
declare @Result int = 0
declare @ErrMsg varchar(200) = ''
exec GetMember '100025420106001',10004143,@Result output,@ErrMsg output
print @Result
print @ErrMsg
-----------------------------------------------------------------------------------------------------------------------------------------

********************************************************************满减促销*************************************************************
-----------------------------------------------------------------------------------------------------------------------------------------
--获取满减信息
declare @MerchId int = 100025
declare @StoreId varchar(15) = ''
declare @MemberLevelId int = 2
declare @MemberId int = 33
declare @FoodPrice decimal(18,2) = 200
declare @SubPrice decimal(18,2) = 0
declare @DiscountRuleID int
declare @ErrMsg varchar(200) = ''
declare @RS int = 0
exec @RS = GetDiscount @MerchId,@StoreId,@MemberLevelId,@MemberId,@FoodPrice,@DiscountRuleID output,@SubPrice output,@ErrMsg output
print @RS
print @ErrMsg
print @SubPrice
print @DiscountRuleID
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取满减信息 
 declare @RS int = 0
 declare @MerchId varchar(15) = '100025'
 declare @StoreId varchar(15) = '100025420106001'
 declare @MemberId int = 33
 declare @DiscountRuleID int = 1
 declare @StoreFreq int = 0
 declare @MemberFreq int = 0
 exec @RS = AddMemberDiscount @MerchId,@StoreId,@MemberId,@DiscountRuleID,@StoreFreq,@MemberFreq
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
 select dbo.GetDiscountRecordByStoreId('100025','100025420106001',1)


-----------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
--获取会员基础信息
declare @ICCardID varchar(50) = '10004143'
declare @StoreID varchar(50) = '100025420106001' 
declare @Result int = 0
declare @ErrMsg varchar(200) = ''
declare @MemberId varchar(32)
declare @CardId int
CREATE TABLE dbo.#Tmp_MemberBaseInfo(CardId int,ICCardID varchar(20) NULL,MemberLevelID int NULL,MemberName varchar(50) NULL,Gender int NULL,Birthday varchar(100) NULL,
IDCard varchar(18) NULL,Mobile varchar(11) NULL,Deposit numeric(18, 2) NULL,Note text NULL,EndDate varchar(100) NULL,RepeatCode int NULL,MemberState int NULL,CardStatus int NULL,
MemberLevelName varchar(20) NULL,StoreID varchar(15) NOT NULL,StoreName varchar(50) NULL)
insert into #Tmp_MemberBaseInfo
exec [GetMemberBaseInfo] @ICCardID,@StoreID,@Result output,@MemberId output,@CardId output,@ErrMsg output
CREATE TABLE dbo.#Tmp_MemberBalanceInfo(BalanceIndex int,BanlanceName varchar(50) NULL,Banlance decimal NULL)
insert into #Tmp_MemberBalanceInfo
exec GetMemberBalanceInfo @MemberId

-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
declare @GetMemberIdRS int = 0
declare @MemberId int = 0
declare @StoreId varchar(15) = '100025420106001'
declare @ICCardId int = 10004143
declare @CanUse bit = 0
declare @CardStatusName varchar(200) = ''
declare @ErrMsg varchar(200) = ''
exec @GetMemberIdRS = GetMemberId @StoreId,@ICCardId,@MemberId output,@CanUse output,@CardStatusName output,@ErrMsg output
print @GetMemberIdRS
print @MemberId
print @CanUse
print @CardStatusName
print @ErrMsg
-----------------------------------------------------------------------------------------------------------------------------------------

-----------------------------------------------------------------------------------------------------------------------------------------
declare @MerchId int = 100025
declare @StoreId varchar(15) = '100025420106001'
declare @CustomerType int = 2
declare @ICCardId int = 10004143
declare @FoodPrice decimal(18,2) = 200
declare @SubPrice decimal(18,2) = 0
declare @DiscountRuleID int
declare @ErrMsg varchar(200) = ''
declare @DiscountRuleName varchar(200) = ''
declare @RS int = 0
exec @RS = GetDiscountForAPI @MerchId,@StoreId,@CustomerType,@ICCardId,@FoodPrice,@DiscountRuleID output,@SubPrice output,@DiscountRuleName output,@ErrMsg output
print @RS
print @ErrMsg
print @SubPrice
print @DiscountRuleID
print @DiscountRuleName
-----------------------------------------------------------------------------------------------------------------------------------------

--添加码表
declare @StoreId varchar(15) = '100025420106001'
declare @HeadIndex int = 0
declare @UserId int = 0
declare @InCoin int = 100
declare @PrizeCount int = 100
declare @OutCoin int = 100
declare @OutLottery int = 100
declare @MediaUrl1 varchar(200) = 'fewfew'
declare @MediaUrl2 varchar(200) = ''
declare @MediaUrl3 varchar(200) = ''
declare @InCoinError int 
declare @OutCoinError int 
declare @PrizeError int 
declare @OutLotteryError int 
declare @GoodPrice decimal(18,2) 
declare @ErrMsg varchar(200) 
declare @RS int = 0

exec @RS = AddGameWatch @StoreId,@HeadIndex,@UserId,@InCoin,@PrizeCount,@OutCoin,@OutLottery,@MediaUrl1,@MediaUrl2,@MediaUrl3,
@InCoinError output,@OutCoinError output ,@PrizeError output ,@OutLotteryError output ,@GoodPrice output,@ErrMsg output


----------------------------------------------------------------------------------------------------
declare @StoreId varchar(15)
declare @CustomerType int = 0
declare @MemberLevelId int = 1
declare @MemberBalanceList [MemberBalanceListType]
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98305,'储值金',100)
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98306,'代币',100)
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98307,'积分',100)
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98308,'彩票',100)
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98309,'test',100)
insert into @MemberBalanceList(BalanceIndex,BalanceName,Balance) values(98315,'现金',100)

declare @FoodDetailType [FoodDetailType]
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(3,1,98305,100)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(1,1,0,1000)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(6,1,98306,100)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(4,1,98307,100)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(7,1,98308,100)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(5,1,98309,100)
insert into @FoodDetailType(FoodId,FoodCount,PayType,PayNum) values(8,1,98315,500)

declare @PayCount decimal(18,2) = 1000
declare @RealPay decimal(18,2) = 1000
declare @FreePay decimal(18,2) = 0
declare @IsThirdPay bit = 0
declare @ErrMsg varchar(200)
decLare @RS int
exec @RS = [CheckOrderPay] @StoreId,@CustomerType,@MemberLevelId,@MemberBalanceList,@FoodDetailType,@PayCount,@RealPay,@FreePay,@IsThirdPay output,@ErrMsg output
print '@RS:' + cast(@RS as varchar)
print '@ErrMsg:' + @ErrMsg  

----------------------------------------------------------------------------------------------------

declare @Return int
declare @StoreId varchar(15) = '100025420106001'
declare @CustomerType int = 2
declare @MemberLevelId int = 21
declare @Mobile varchar(11) = '15618920033'
declare @ICCardId int = 10004143
declare @PayCount decimal(18,2) = 5.5 + 50
declare @Deposit decimal(18,2) = 0
declare @OpenFee decimal(18,2) = 0
declare @UserID decimal = 3
declare @WorkStation varchar(50) = 'lijunjie'
declare @AuthorID int = 0
declare @Note varchar(500) = ''
declare @OrderSource int = 0
declare @SaleCoinType int = 1

declare @OrderFlwId varchar(32) = 0
declare @ErrMsg varchar(200) = ''
declare @FoodSaleDetailList [FoodSaleDetailListType]
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(1,0,1,0,1/2.0)
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(3,0,2,0,10/2.0)
--insert into @FoodDetailType(FoodId,Category,FoodCount,PayType,PayNum) values(101,1,0,20/2.0)--开卡套餐
--insert into @FoodDetailType(FoodId,Category,FoodCount,PayType,PayNum) values(3,1,98305,100)-----------
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(6,0,1,98306,100)
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(4,0,1,98307,100)
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(1,1,1,0,20)
insert into @FoodSaleDetailList(FoodId,Category,FoodCount,PayType,PayNum) values(4,2,1,0,30)
--insert into @FoodDetailType(FoodId,Category,FoodCount,PayType,PayNum) values(7,1,98308,100)
--insert into @FoodDetailType(FoodId,Category,FoodCount,PayType,PayNum) values(5,1,98309,100)
--insert into @FoodDetailType(FoodId,Category,FoodCount,PayType,PayNum) values(8,1,98315,500)
declare @FlwSeedId varchar(29) = '100025420106001' + '20180517' + '000010'
exec @Return = CreateOrder @FoodSaleDetailList,@StoreId,@CustomerType,@Mobile,@MemberLevelId,@ICCardId,@PayCount,@Deposit,@OpenFee,
@UserID,@WorkStation,@AuthorID,@Note,@OrderSource,@SaleCoinType,@FlwSeedId,@OrderFlwId output,@ErrMsg output
print @Return 
print @ErrMsg
print @OrderFlwId

----------------------------------------------------------------------------------------------------
declare @StoreId varchar(15) = '100025420106001'
declare @GetFoodInfoReturn int
declare @FoodName varchar(200)
declare @FoodType int 
declare @FoodSalePrice decimal(18,2)
declare @AllowPrint int
declare @ForeAuthorize int 
declare @AllowInternet int
declare @AllowCoin int
declare @Coins decimal(18,2)
declare @AllowPoint int
declare @Points decimal(18,2)
declare @AllowLottery int
declare @Lotterys decimal(18,2)
declare @ErrMsg varchar(200)
exec @GetFoodInfoReturn = GetFoodInfo @StoreId,133,2,1,@FoodName output,@FoodType output,@FoodSalePrice output,@AllowPrint output,@ForeAuthorize output,@AllowInternet output,@ErrMsg output
print @GetFoodInfoReturn
print @FoodSalePrice
----------------------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------------------
declare @FoodDetailCount int
declare @FoodDetail [FoodDetailType]
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(3,1,98305,100)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(1,1,0,1000)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(6,1,98306,100)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(4,1,98307,100)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(7,1,98308,100)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(5,1,98309,100)
insert into @FoodDetail(FoodId,FoodCount,PayType,PayNum) values(8,1,98315,500)
exec GetFoodDetailCount @FoodDetail,@FoodDetailCount output
print @FoodDetailCount
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
declare @StoreId varchar(15) = '100025420106001'
exec dbo.GetFoodDetail @StoreId,133
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
select * from Data_FoodInfo where FoodID in (133,135,136,138)
declare @FoodDetailCommonQueryType FoodDetailCommonQueryType 
insert @FoodDetailCommonQueryType(FoodId,FoodType) values(133,0) 
insert @FoodDetailCommonQueryType(FoodId,FoodType) values(135,2) 
insert @FoodDetailCommonQueryType(FoodId,FoodType) values(136,3) 
insert @FoodDetailCommonQueryType(FoodId,FoodType) values(138,4)
exec [GetCommonFoodListInfo] @FoodDetailCommonQueryType,2,1
----------------------------------------------------------------------------------------------------

exec GetMerchOtherStoreMemberCardInfo '100025420106002','15618920033'
----------------------------------------------------------------------------------------------------

declare @Result int = 0 
exec @Result = CheckStoreIsInAllGroupRule '100025420106001'
print @Result

----------------------------------------------------------------------------------------------------
     declare @ResultOpenCard int 
     declare @ErrMsg varchar(200)
	 exec @ResultOpenCard = CheckStoreCanOpenCard '100025420106002','15618920033',@ErrMsg output
	 print @ResultOpenCard
-----------------------------------------------------------------------------------------------------
declare @CurrentSchedule int = 0
declare @OpenTime varchar(20) = ''
declare @errMsg varchar(200) = ''
declare @Return int = 0
exec @Return = GetSchedule '100025420106001',3,'lijunjie',@CurrentSchedule output,@OpenTime output,@errMsg output
print @Return
print @CurrentSchedule
print @errMsg
-------------------------------------------------------------------------------------------------------

获取会员等级
exec GetMemberLevel '100025420106001'

-------------------------------------------------------------------------------------------------------
declare @AuthorFlag int
declare @FreePrice decimal(18,2) = 0.1
declare @ErrMsg varchar(200)
declare @Rs int
declare @CouponListType [CouponListType]
--插入优惠券
--insert @CouponListType(CouponCode) values('5ca8ac12733a4b7791168cc10bd89624')
--insert @CouponListType(CouponCode) values('4fb06d7d70b1409fa9bc56224145b65d')
--插入折扣券
insert @CouponListType(CouponCode) values('980be011b25449aab5753ab0fd57c1f5')
insert @CouponListType(CouponCode) values('cd6bb819e5f9453c87013d64689945a7')
insert @CouponListType(CouponCode) values('76d1f7c43571429b89ad5f516ca762fa')

declare @Str varchar(500)
exec @Rs = CheckCoupon @CouponListType,'100025420106001',100,@AuthorFlag output,@FreePrice output,@ErrMsg output
print '@Rs:' + cast(@Rs as varchar)
print '@FreePrice:' + cast(@FreePrice as varchar)
print '@ErrMsg:' + @ErrMsg

-------------------------------------------------------------------------------------------------------
declare @CouponId int
declare @CouponCount int
declare @Rs int
declare @ErrMsg varchar(8000)
declare @CouponListType [CouponListType]
insert @CouponListType(CouponCode) values('66d221152a724c4bbe7e8cbc7606195a')
insert @CouponListType(CouponCode) values('9c4af63a9669483d90b09cf064cbaf0d')
exec @Rs = CheckCouponInvalid '100025420106001',@CouponListType,@CouponId output,@CouponCount output,@ErrMsg output
print '@Rs' + cast(@Rs as varchar)
print '@CouponCount:' + cast(@CouponCount as varchar)
print '@ErrMsg:' + @ErrMsg
-------------------------------------------------------------------------------------------------------

declare @FreePrice decimal(18,2) 
exec GetDiscountPrice 100,0.92,3,@FreePrice output
print @FreePrice