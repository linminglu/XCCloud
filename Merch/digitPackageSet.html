<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数字币套餐设置</title>
    <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body>
<div class="layui-row" style="padding: 15px">
    <blockquote class="layui-elem-quote" style="text-align: right">
        <button type="button" class="layui-btn layui-btn-normal" i18n-content="查询模板"></button>
        <button type="button" class="layui-btn layui-btn-normal add" i18n-content="新增"></button>
    </blockquote>
    <div class="layui-col-md12 layui-col-lg12 layui-col-sm12">
        <table class="layui-hide" id="digitPackageTb"  lay-filter="digitPackageTb"></table>
    </div>
</div>
<!--新增弹窗-->
<div id="openModel" style="display: none;padding: 10px;">
    <form action="" class="layui-form layui-form-pane">
        <div class="layui-form-item">
            <label class="layui-form-label" i18n-content="套餐名称"></label>
            <div class="layui-input-block">
                <input name="" id="FoodName" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" i18n-content="活动定金"></label>
            <div class="layui-input-block">
                <select id="BalanceType" lay-filter="BalanceType" ></select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" i18n-content="数量"></label>
            <div class="layui-input-block">
                <input name="" id="FoodCount" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item goodIsAll">
            <label class="layui-form-label" style="padding: 8px 0" i18n-content="是否需要授权"></label>
            <div class="layui-input-block">
                <input type="checkbox" name="switch" lay-skin="switch" id="AuthorFlag" lay-filter="AuthorFlag" lay-text="需要授权|自由售卖">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" i18n-content="说明"></label>
            <div class="layui-input-block">
                <input name="" id="Note" class="layui-input">
            </div>
        </div>
        <div style="text-align: center;padding-top: 15px">
            <button type="reset" class="layui-btn layui-btn-normal" id="saveTimeReset"><i class="layui-icon">&#x1002;</i><span i18n-content="重置"></span></button>
            <button type="button" class="layui-btn layui-btn-normal" id="lastSave"><i class="layui-icon">&#xe6af;</i><span i18n-content="确定"></span></button>
        </div>
    </form>
</div>
</body>
<script src="js/jquery-1.8.3-min.js"></script>
<script src="layui/layui.js"></script>
<script src="js/storeSystem.js"></script>
<script src="changeLanguage/di18n.min.js"></script>
<script>
    let xc=xcActionSystem.prototype;
    let token=xc.getStorage('token');
    let  xc_language=xc.getStorage('xc_language');
    let xc_message={ English: {
            '新增': 'add','套餐名称':'PackageName','活动定金':'activeDeposit','数量':'count','是否需要授权':'needAuthor','说明':'note','确定':'sure','重置':'reset','查询模板':'searchModel'
        },
        Chinese: {
            '新增': '新增','套餐名称':'套餐名称','活动定金':'活动定金','数量':'数量','是否需要授权':'是否需要授权','说明':'说明','确定':'确定','重置':'重置','查询模板':'查询模板'
        },
        French:{

        }};
    const di18n = new DI18n({
        locale: xc_language,
        isReplace: true,   // 开启运行时
        messages: xc_message
    });
    let cols;
    if(xc_language=='Chinese'){
        cols=[
            {field:'ID', title:'套餐编号', align: 'center', sort: true}
            ,{field:'FoodName',title: '套餐名称', align: 'center',templet:'#foodNames'} //width 支持：数字、百分比和不填写。
            ,{field:'BalanceIndexStr', title: '活动定金', align: 'center'}
            ,{field:'Coins', title: '数量', align: 'center'}
            ,{field:'AuthorFlag', title: '授权标记', align: 'center',templet:'#AuthorFlag'}
            ,{field:'Note', title: '说明', align: 'center'}
            ,{fixed: 'right', title: '操作', width:180, align:'center', toolbar: '#barDemo'}]
    }else if(xc_language=='English'){
        cols=[
            {field:'ID', title:'ID', align: 'center', sort: true}
            ,{field:'FoodName',title: 'FoodName', align: 'center',templet:'#foodNames'} //width 支持：数字、百分比和不填写。
            ,{field:'BalanceIndexStr', title: 'BalanceIndexStr', align: 'center'}
            ,{field:'Coins', title: 'Count', align: 'center'}
            ,{field:'AuthorFlag', title: 'AuthorFlag', align: 'center',templet:'#AuthorFlag'}
            ,{field:'Note', title: 'Note', align: 'center'}
            ,{fixed: 'right', title: 'action', width:180, align:'center', toolbar: '#barDemo'}]
    }
    let parm={'obj':{'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'},
        'url':'/XCCloud/DigitFood?action=QueryDigitFood',
        'elem':'#digitPackageTb',
        'cols':cols
    };
    xc.getInitData(parm);

    let id;
    let BalanceType=''; let AuthorFlag=0;
    layui.use(['form','layer','table'],function () {
        let form=layui.form;
        let  layer=layui.layer;
        let table=layui.table;

        form.on('select(BalanceType)',function (data) {
            BalanceType=data.value;
        });
        form.on('switch(AuthorFlag)',function (data) {
            if(data.elem.checked==true){
                AuthorFlag=1;
            }else {
                AuthorFlag=0
            }
        });
        table.on('tool(digitPackageTb)',function (obj) {
            let data=obj.data;
            let layEvent=obj.event;
            id=data.ID;
            if(layEvent==='edit'){
                let _obj={'id':data.ID,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                let parseJson = JSON.stringify(_obj);
                $.ajax({
                    type:'post',
                    url:'/XCCloud/DigitFood?action=GetDigitFoodInfo',
                    contentType: "application/json; charset=utf-8",
                    data:{parasJson: parseJson},
                    success: function (data) {
                        data = JSON.parse(data);
                        if (data.result_code == 1) {
                             $('#FoodName').val(data.result_data.FoodName);
                             BalanceType=data.result_data.BalanceIndex;
                            xc.getBalanceTypeDic(token,layer,form,'BalanceType',data.result_data.BalanceIndex);
                             $('#FoodCount').val(data.result_data.Coins);
                             AuthorFlag=data.result_data.AuthorFlag;
                             if(data.result_data.AuthorFlag==1){
                                 $('#AuthorFlag').attr('checked',true)
                             }else {  $('#AuthorFlag').attr('checked',false)}
                             $('#Note').val(data.result_data.Note);
                             form.render();
                            layer.open({
                                title:'新增套餐',
                                type:1,
                                area:['40%','400px'],
                                content:$('#openModel')
                            })
                        } else {
                            layer.msg(data.result_msg||return_msg);
                        }
                    }
                })
            }else if(layEvent==='del'){
                layer.confirm('确定删除该条规则吗？', function(index){
                    let _obj={'id':data.ID,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type:'post',
                        url:'/XCCloud/DigitFood?action=DelDigitFoodInfo',
                        contentType: "application/json; charset=utf-8",
                        data:{parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                               layer.msg('删除成功',{time:1000},function () {
                                   obj.del();
                               })
                            } else {
                                layer.msg(data.result_msg);
                            }
                        }
                    })
                });
            }
        })
        //点击弹出弹窗
        $('.add').on('click',function () {
             id='';BalanceType='';  AuthorFlag=0;
            xc.getBalanceTypeDic(token,layer,form,'BalanceType');
            $('#openModel').find('input').val('');
            layer.open({
                title:'新增套餐',
                type:1,
                area:['40%','400px'],
                content:$('#openModel')
            })
        });
        //保存新方案设置
        $('#lastSave').on('click',function () {
           let obj={'id':id,
               'foodName':$('#FoodName').val(),
               'balanceIndex':BalanceType,
               'coins':$('#FoodCount').val(),
               'authorFlag':AuthorFlag,
               'note':$('#Note').val(),
               'userToken':token,
               'signkey':'1f626576304bf5d95b72ece2222e42c3'};
            var parasJson = JSON.stringify(obj);
            $.ajax({
                type: "post",
                url: '/XCCloud/DigitFood?action=SaveDigitFoodInfo',
                contentType: "application/json; charset=utf-8",
                data: { parasJson: parasJson },
                success: function (data) {
                    data=JSON.parse(data);
                    if(data.result_code==1){
                        layer.msg('保存成功',{time:1000},function () {
                            location.href='digitPackageSet.html'
                        })
                    }else {
                        layer.msg('操作失败');
                        return false;
                    }
                }
            })
        });

        //表格钻取
        $('body').on('click','button',function () {
            console.log($(this))
            console.log($(this).text())
        })
    })
</script>
<script type="text/html" id="barDemo">
    {{# if(xc_language=='English'){ }}
    <a class="layui-btn layui-btn-xs" lay-event="edit"> <i class="layui-icon">&#xe642;</i>edit</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del"> <i class="layui-icon">&#xe642;</i>delete</a>
    {{# }else if(xc_language=='Chinese'){ }}
    <a class="layui-btn layui-btn-xs" lay-event="edit"> <i class="layui-icon">&#xe642;</i>编辑</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del"> <i class="layui-icon">&#xe642;</i>删除</a>
    {{#  } }}
</script>
<script type="text/html" id="foodNames">
    {{# if(d.FoodName){ }}
    <button type="button" class="layui-btn layui-btn-sm" id="{{d.ID}}">{{d.FoodName}}</button>
    {{#  } }}
</script>
</html>