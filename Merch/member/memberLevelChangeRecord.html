<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员级别变更记录</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/myxc.css">
</head>
<body>
<div class="layui-row reportPage">
    <div class="row-box">
        <div class="layui-col-md12 layui-col-sm12 layui-col-lg12">
            <blockquote class="layui-elem-quote layui-col-md12 layui-col-sm12 layui-col-lg12">
                <div class="layui-form layui-form-pane layui-col-md8 layui-col-sm6 layui-col-xs6 layui-col-lg9" id="form1">
                    <div class="layui-form-item" id="serchMode"></div>
                </div>
                <div class="layui-col-md4 layui-col-sm6 layui-col-xs6 layui-col-lg3">
                    <div class="layui-col-md6 layui-col-sm6 layui-col-xs6 layui-col-lg6" id="form2Box" style="">
                        <div class="layui-form layui-form-pane" id="form2" style="">
                            <div id="tantion" class="layui-form-item">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md6 layui-col-sm6 layui-col-xs6 layui-col-lg6" style="padding-left: 20px;">
                        <button type="button" class="layui-btn layui-btn-normal " i18n-content="查询模板"
                                id="searchBtn">查询
                        </button>
                        <button type="button" class="layui-btn layui-btn-normal " i18n-content="查询模板"
                                id="reSearchBtn">重置
                        </button>
                    </div>
                </div>

            </blockquote>
        </div>
        <div class="layui-col-md12 layui-col-sm12 layui-col-lg12">
            <table class="layui-hide" lay-filter="mLevelChangeTable" id="mLevelChangeTable"></table>
        </div>
    </div>
</div>
</body>
<script src="../js/jquery-1.8.3-min.js"></script>
<script src="../layui/layui.js"></script>
<script src="../js/storeSystem.js"></script>
<script src="../js/searchModel.js"></script>
<script>
    let xc = xcActionSystem.prototype;
    let token = xc.getStorage('token');
    let Id = '';
    let indexLayer;
    //初始化table
    let parm = {
        'obj': {'conditions':[],'userToken': token, 'signkey': '1f626576304bf5d95b72ece2222e42c3'},
        'url': '/XCCloud/MemberManage?action=QueryMemberLevelChange',
        'elem': '#mLevelChangeTable',
        'cols': [
            {field: 'ICCardID', title: '会员卡号', align: 'center', sort: true,templet:'#_ICCard'}
            , {field: 'UserName', title: '姓名', align: 'center'}
            , {field: 'OpTime', title: '变更时间', align: 'center'}
            , {field: 'OldMemberLevelName', title: '原会员等级', align: 'center',templet:'#_cardType'}
            , {field: 'NewMemberLevleName', title: '新会员等级', align: 'center',templet:'#_deposit'}
            , {field: 'ChangeTypeStr', title: '变更途径', align: 'center'}
            , {field: 'OrderID', title: '相关订单号', align: 'center'}
            , {field: 'StoreName', title: '操作门店', align: 'center'}
            , {field: 'CheckDate', title: '营业日期', align: 'center'}
            , {field: 'ScheduleName', title: '班次', align: 'center'}
            , {field: 'WorkStation', title: '操作终端', align: 'center'}
            , {field: 'OpUserName', title: '操作员', align: 'center'}
            , {field: 'Note', title: '备注', align: 'center'}

        ]
    };
    // xc.getInitData(parm);
    layui.use(['form','layer','table','laydate'],function () {
        let form=layui.form;
        let layer=layui.layer;
        let table=layui.table;
        let laydate=layui.laydate;
        seachModel({
            'elem1': 'tantion',
            'elem2': 'serchMode',
            'pagename': 'memberLevelChangeSearch',
            'processname': 'memberLevelChangeSearch',
            'token': token,
            'form': form,
            'layer': layer,
            'searchBtn': 'searchBtn',
            'reSearchBtn':'reSearchBtn',
            'needIcCard':'needIcCard',
            'xc':xc,
            'laydate':laydate,
            'parm':parm,
            'types':''
        })
        table.render({
            elem: parm.elem
            , data: []
            , cellMinWidth: 120 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            , cols: [parm.cols]
            , page: {page: true, limits: [10, 15, 20, 30, 50, 100]}
            , limit: 10
            , total: parm.total
            , done: function () {
                if (this.total) {
                    let _col = this.cols[0];
                    let _data = this.data;
                    var intHtml = '<tr style="background-color: #93D1FF">';
                    intHtml += '<td style="text-align:center;">合计:' + this.data.length + '条</td>';
                    for (let i = 1; i < _col.length; i++) {
                        if (_col[i].total) {
                            let index = _col[i].field;
                            let count = 0;
                            for (let j in _data) {
                                count += parseInt(_data[j][index])
                            }
                            intHtml += '<td style="color: red;font-weight: bold;text-align:center;">' + count + '</td>'
                        } else {
                            intHtml += '<td></td>'
                        }
                    }
                    $(".layui-table-body.layui-table-main tbody").append(intHtml);
                }
            }
        });
    })
</script>
<script type="text/html" id="_ICCard"></script>
<script type="text/html" id="assigned"></script>
<script type="text/html" id="_deposit"></script>
</html>