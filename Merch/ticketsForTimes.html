<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>次票设置</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="css/myxc.css">

</head>
<style>
    .tableName:hover{
        text-decoration: underline;!important;
    }
</style>
<body>
<div class="layui-row settingPage">
    <div class="row-box">

        <blockquote class="layui-elem-quote" style="text-align: right">
            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" i18n-content="查询模板">查询模板</button>
            <!--<button type="button" class="layui-btn layui-btn-normal add" i18n-content="新增">新增</button>-->
        </blockquote>
        <table class="layui-hide" id="timesTickets" lay-filter="timesTickets"></table>

        <button type="button" class="layui-btn layui-btn-sm layui-btn-primary" id="editBtn">编辑</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-normal add" i18n-content="新增">新增</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger " id="delBtn">删除</button>
    </div>

</div>
<!--//弹窗层   -->

</body>
<script src="js/jquery-1.8.3-min.js"></script>
<script src="layui/layui.js"></script>
<script src="js/storeSystem.js"></script>
<script>
    var xc = xcActionSystem.prototype;
    var token = xc.getStorage('token');
    var parm = {
        'obj': {'ticketType': 0, 'businessType': 0, 'userToken': token, 'signkey': '1f626576304bf5d95b72ece2222e42c3'},
        'url': '/XCCloud/ProjectTicket?action=QueryProjectTicket',
        'elem': '#timesTickets',
        'cols': [
            {type:'checkbox', fixed: 'left'},
            {field: 'ID', title: '项目ID', align: 'center', sort: true, fixed: 'left'},
            {field: 'TicketName', title: '门票名称', align: 'center', fixed: 'left',  templet: function (d) {
                    let str = d.TicketName;

                    return '<a href="#" class="tableName" name="'+d.ID+'" style="">'+d.TicketName+'</a>';
                }}
            , {field: 'Price', title: '售价', align: 'center'}
            , {field: 'ValidDate', title: '有效期', align: 'center'}
            , {field: 'WriteOffDays', title: '核销期', align: 'center'}
            , {
                field: 'WeekTypeStr', title: '限定游玩期限', align: 'center',
                templet: function (d) {
                    let str = d.WeekTypeStr;
                    let res_ = '';
                    if (str.indexOf('1') !== -1) {
                        res_ += '周一、';
                    }
                    if (str.indexOf('2') !== -1) {
                        res_ += '周二、';
                    }
                    if (str.indexOf('3') !== -1) {
                        res_ += '周三、';
                    }
                    if (str.indexOf('4') !== -1) {
                        res_ += '周四、';
                    }
                    if (str.indexOf('5') !== -1) {
                        res_ += '周五、';
                    }
                    if (str.indexOf('6') !== -1) {
                        res_ += '周六、';
                    }
                    if (str.indexOf('7') !== -1) {
                        res_ += '周天、';
                    }
                    res_ = res_.substring(0, res_.length - 1);
                    if (res_ == "周一、周二、周三、周四、周五、周六、周天") {
                        res_ = "全周"
                    }
                    return res_;
                }

            }
            , {field: 'PeriodLimit', title: '限定时段', align: 'center', templet: '#charge'}
            , {field: 'NoDate', title: '不可用日期', align: 'center', templet: '#state'}
            , {field: 'ExitLimit', title: '退票信息', align: 'center'}
            , {field: 'BindProjects', title: '项目信息', align: 'center'}
            , {field: 'AllowExitTimes', title: '离场时间', align: 'center'}
            // ,{fixed: 'right',title: '操作', width:240, align:'center', toolbar: '#barDemo'}
        ]
    };
    xc.getInitData(parm);
    let id = '';

    layui.use(['table', 'form', 'layer'], function () {
        let table = layui.table;
        let form = layui.form;
        let layer = layui.layer;
        //新增，存入一个cook
        $('.add').on('click', function () {
            layer.open({
                title: '新增',
                type: 2,
                area: ['1045px', '650px'],
                content: 'ticketsIframe.html'
            });
            xc.setStorage('ticketSet', JSON.stringify({'way': 'add', 'name': 'times', 'id': ''}))

        });
        //删除按钮
        $('#delBtn').on('click', function () {
            let checkStatus = table.checkStatus('timesTickets'); //test即为基础参数id对应的值
            let len = checkStatus.data.length;
            if (len == 1) {
                // let ids = '';
                // ids = checkStatus.data[0].ID;
                layer.confirm('FBI warming：停用可联系莘宸管理员恢复，是否确定停用?', function (index) {
                    var _obj = {
                        'id': checkStatus.data[0].ID,
                        'userToken': token,
                        'signkey': '1f626576304bf5d95b72ece2222e42c3'
                    };
                    var url = '/XCCloud/Project?action=DelProjectInfo';
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type: 'post',
                        url: '/XCCloud/ProjectTicket?action=DelProjectTicket',
                        contentType: "application/json; charset=utf-8",
                        data: {parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                                layer.msg('本套餐停用成功', {time: 1500}, function () {
                                    layer.close(index);
                                    location.reload()
                                })
                            } else {
                                layer.msg(data.result_msg);
                            }
                        }
                    })
                });

            } else {
                layer.msg('请至少勾选一条数据！')
            }
        });
        //编辑按钮
        $('#editBtn').on('click', function () {
            let checkStatus = table.checkStatus('timesTickets'); //test即为基础参数id对应的值
            let len = checkStatus.data.length;
            if (len == 1) {

                layer.open({
                    title: '修改设置',
                    type: 2,
                    area: ['1045px', '650px'],
                    content: 'ticketsIframe.html'
                });
                xc.setStorage('ticketSet', JSON.stringify({
                    'way': 'modify',
                    'name': 'times',
                    'id': checkStatus.data[0].ID
                }))

            } else {
                layer.msg('请且勾选一条数据！')
            }
        });

    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del"><i class="layui-icon">&#xe640;</i>删除</a>
    <!--<a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="edit"><i class="layui-icon">&#xe642;</i>编辑</a>-->
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="modify"><i class="layui-icon">&#xe642;</i>修改</a>
</script>

</html>