<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员级别设定</title>
    <link rel="stylesheet" href="layui/css/layui.css">
</head>
<style>
    .layui-colla-content1 .lfl1{width: 135px}
    /*.layui-colla-content1 .layui-form-mid{width: 50px}*/
</style>
<body>
    <div class="layui-row" style="padding: 15px">
        <blockquote class="layui-elem-quote" style="text-align: right;padding-right: 100px;">
            <button type="button" class="layui-btn layui-btn-normal" id="searchBtn"><i class="layui-icon">&#xe615;</i>搜索</button>
             <button type="button" class="layui-btn layui-btn-normal" id="look"><i class="layui-icon">&#xe615;</i>查询</button>
             <button type="button" class="layui-btn layui-btn-normal" id="add"><i class="layui-icon">&#xe654;</i>新增</button>

        </blockquote>
        <div class="layui-col-md12 layui-col-lg12 layui-col-sm12">
            <table class="layui-hide" id="memberLevelTb"  lay-filter="memberLevelTb"></table>
        </div>
    </div>

  <!--//弹出层-->
  <div id="openModel" style="display: none">
      <form action="" class="layui-form layui-form-pane">
          <div class="layui-collapse" lay-accordion>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">封面</h2>
                  <div class="layui-colla-content layui-show">
                      tu片
                  </div>
              </div>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">开卡</h2>
                  <div class="layui-colla-content  layui-colla-content1 " >
                     <div class="layui-form-item">
                         <div class="layui-inline">
                             <label  class="layui-form-label ">开户费</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid" style="width: 68.45px">(元)</div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label ">押金</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid">(元)</div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label" style="padding: 8px 0!important;">积分清零周期</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid">(天)</div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label ">兑换折扣率</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid">(0.00-1.00)</div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label ">有效天数</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid">(天)</div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label ">兑币范围</label>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                             <div class="layui-form-mid">至</div>
                             <div class="layui-input-inline lfl1">
                                 <input type="text" class="layui-input">
                             </div>
                         </div>
                         <!--<div class="layui-inline">-->
                             <!--<label  class="layui-form-label ">最小退币数</label>-->
                             <!--<div class="layui-input-inline lfl1">-->
                                 <!--<input type="text" class="layui-input">-->
                             <!--</div>-->
                         <!--</div>-->
                         <div class="layui-inline">
                             <label  class="layui-form-label" style="padding: 8px 0!important;">开卡需要授权</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label" style="padding: 8px 0!important;">身份证读卡</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                         <br>
                         <div class="layui-inline">
                             <label  class="layui-form-label">手机号必填</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label">身份证必填</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label">人脸识别</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                         <div class="layui-inline">
                             <label  class="layui-form-label">掌纹识别</label>
                             <div class="layui-input-inline">
                                 <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                             </div>
                         </div>
                     </div>
                  </div>
              </div>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">变更</h2>
                  <div class="layui-colla-content ">
                      <div class="layui-form-item">
                          <div class="layui-inline">
                              <label  class="layui-form-label">换卡费</label>
                              <div class="layui-input-inline">
                                  <input type="text" class="layui-input">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">续期费</label>
                              <div class="layui-input-inline"><input type="text" class="layui-input"></div>
                          </div>
                          <div class="layui-inline"><label  class="layui-form-label">续期扣积分</label>
                              <div class="layui-input-inline"><input type="text" class="layui-input"></div>
                          </div>
                      </div>
                      <div class="layui-form-item">
                          <div class="layui-inline">
                              <label  class="layui-form-label">升级扣积分</label>
                              <div class="layui-input-inline"><input type="text" class="layui-input"></div>
                          </div>
                          <div class="layui-inline"><label class="layui-form-label" style="padding: 8px 0!important;">升级累计消费</label>
                              <div class="layui-input-inline"><input type="text" class="layui-input"></div>
                          </div>
                          <div class="layui-inline"><label  class="layui-form-label" style="padding: 8px 0!important;">降级非活跃天数</label>
                              <div class="layui-input-inline"><input type="text" class="layui-input"></div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">送币规则</h2>
                  <div class="layui-colla-content ">
                      <div class="layui-form-item">
                          <div class="layui-inline">
                              <label class="layui-form-label">送币频率</label>
                              <div class="layui-input-inline">
                                  <select name="" id=""></select>
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">送币数</label>
                              <div class="layui-input-inline">
                                  <input type="text" class="layui-input">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">送币方式</label>
                              <div class="layui-input-inline">
                                  <select name="" id=""></select>
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">送币条件</label>
                              <div class="layui-input-inline">
                                  <input type="text" class="layui-input">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label" style="padding: 8px 0!important;">生日送币方式</label>
                              <div class="layui-input-inline">
                                  <select name="" id=""></select>
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">送币数</label>
                              <div class="layui-input-inline">
                                  <input type="text" class="layui-input">
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">兑换方式</h2>
                  <div class="layui-colla-content ">
                      <div class="layui-form-item">
                          <div class="layui-inline">
                              <label  class="layui-form-label">允许退卡</label>
                              <div class="layui-input-inline">
                                  <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">允许退款</label>
                              <div class="layui-input-inline">
                                  <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label" style="padding: 8px 0!important;">投币后拔卡锁机头</label>
                              <div class="layui-input-inline">
                                  <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                              </div>
                          </div>
                          <div class="layui-inline">
                              <label  class="layui-form-label">允许下分</label>
                              <div class="layui-input-inline">
                                  <input type="checkbox" name="zzz" lay-skin="switch" lay-text="启用|禁用">
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="layui-colla-item">
                  <h2 class="layui-colla-title">预赠币</h2>
                  <div class="layui-colla-content ">
                      <div class="layui-form-item">
                          <div class="layui-inline">
                              <label  class="layui-form-label">充值满</label>
                              <div class="layui-input-inline" style="width: 90px">
                                  <input type="text" class="layui-input" >
                              </div>
                              <div class="layui-form-mid">元，预赠币</div>
                              <div class="layui-input-inline" style="width: 90px">
                                  <input type="text" class="layui-input" >
                              </div>
                              <div class="layui-form-mid">最小间隔</div>
                              <div class="layui-input-inline" style="width: 90px">
                                  <input type="text" class="layui-input" >
                              </div>
                              <div class="layui-form-mid">天,可领</div>
                              <div class="layui-input-inline" style="width: 90px">
                                  <input type="text" class="layui-input" >
                              </div>
                              <div class="layui-form-mid">币,有效天数</div>
                              <div class="layui-input-inline" style="width: 90px">
                                  <input type="text" class="layui-input" >
                              </div>
                          </div>

                      </div>
                  </div>
              </div>
          </div>

          <div style="text-align: right;padding-right: 80px;margin: 15px 0">
              <button type="button" class="layui-btn layui-btn-normal cancleBtn"><i class="layui-icon">&#xe603;</i>取消</button>
              <button type="reset" class="layui-btn layui-btn-danger" id="resetBtn"><i class="layui-icon">&#x1002;</i>重置</button>
              <button type="button" class="layui-btn layui-btn-normal" id="saveMLBtn" onclick="saveML()"><i class="layui-icon">&#xe654;</i>确定</button>
          </div>
      </form>
  </div>

</body>
<script src="js/jquery-1.8.3-min.js"></script>
<script src="layui/layui.js"></script>
<script src="js/storeSystem.js"></script>
<script>
    let xc=xcActionSystem.prototype;
    let token=xc.getStorage('token');
    let parm={'obj':{'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'},
        'url':'/XCCloud/Member?action=QueryMemberLevel',
        'elem':'#memberLevelTb',
        'cols':[
            {field:'MemberLevelID', title:'级别编号', align: 'center', sort: true,width:80}
            ,{field:'MemberLevelName',title: '级别名称', align: 'center'}
            ,{field:'OpenFee', title: '开户费', align: 'center'}
            ,{field:'Deposit', title: '押金', align: 'center'}
            ,{field:'Validday', title: '有效天数', align: 'center',templet:'#changeLock',width:140}
            ,{field:'ContinueFee', title: '续费期', align: 'center'}
            ,{field:'UpdateUsePoint', title: '升级销毁积分', align: 'center'}
            ,{field:'ConsumeTotle', title: '升级累计金额', align: 'center'}
            ,{field:'BirthdayFreeStr', title: '生日送币方式', align: 'center'}
            ,{field:'FreeTypeStr', title: '送币方式', align: 'center'}
            ,{field:'LogName', title: '操作员', align: 'center'}
        ]
    };
    xc.getInitData(parm);

    var option1='',option2='',option3='',option4='',option5='0',
        radiv1='0',radiv2='0',radiv3='0',radiv4='0';
    layui.use(['form','layer','laydate','table','element'],()=> {
        let layer=layui.layer,
            laydate=layui.laydate,
            table=layui.table,
            form=layui.form,
            element=layui.element,
            upload=layui.upload;
        //新增按钮
        $('#add').on('click',()=>{
             option1='';option2='';option3='';option4='';option5='0';
                radiv1='0';radiv2='0';radiv3='0';radiv4='0';
            layer.open({
                type:1,
                area:'1000px',
                shade:0.6,
                content:$('#openModel')
            });
            xc.setSelect('生日送币方式','barthdayFree');
            xc.setSelect('送币频率','freeRate');
            xc.setSelect('入会时必须输入','mustInput');
            xc.setSelect('送币方式','freeType');
        });
         //修改
        table.on('tool(memberLevelTb)', (obj)=>{
            let data = obj.data; //获得当前行数据
            let layEvent = obj.event;
            $('#demo2').html("");
            let memberLevelID=data.MemberLevelID;
            if(layEvent === 'edit'){ //修改按钮
                $('#resetBtn').trigger('click');
                xc.setStorage('MemberLevelID',memberLevelID);
                let _obj={'memberLevelID':memberLevelID,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                let url='/XCCloud/Member?action=GetMemberLevel';
                let parseJson=JSON.stringify(_obj);
                $.ajax({
                    type:'post',
                    url:url,
                    contentType: "application/json; charset=utf-8",
                    data: { parasJson: parseJson },
                    success:(data)=> {
                        data = JSON.parse(data);
                        console.log(data)
                        if(data.result_code==1){
                            let arr=data.result_data;
                            option1=arr.MustInput;
                            option2=arr.FreeRate;
                            option3=arr.FreeType;
                            option4=arr.BirthdayFree;
                            arr.State ? option5=arr.State : option5=0;
                                radiv1=arr.AllowExitCard;
                                radiv2=arr.AllowExitMoney;
                                radiv3=arr.LockHead;
                                radiv4=arr.AllowExitCoinToCard;
                            if(arr.AllowExitCard==1){
                                $('#AllowExitCard').attr({'checked':true});
                                form.render();
                            }
                            if(arr.AllowExitMoney==1){
                                $('#AllowExitMoney').attr({'checked':true});
                                form.render();
                            }
                            if(arr.LockHead==1){
                                $('#LockHead').attr({'checked':true});
                                form.render();
                            }
                            if(arr.AllowExitCoinToCard==1){
                                $('#AllowExitCoinToCard').attr({'checked':true});
                                form.render();
                            }
                            if(arr.State==1){
                                $('#State').attr({'checked':true});
                                form.render();
                            }
                            xc.setSelect('生日送币方式','barthdayFree',arr.BirthdayFree);
                            xc.setSelect('送币频率','freeRate',arr.FreeRate);
                            xc.setSelect('入会时必须输入','mustInput',arr.MustInput);
                            xc.setSelect('送币方式','freeType',arr.FreeType);
                            $('#levelNames').val(arr.MemberLevelName);
                            $('#deposit').val(arr.Deposit);
                            $('#validday').val(arr.Validday);
                            $('#ExitMoney').val(arr.ExitMoney);
                            $('#ExitCoin').val(arr.ExitCoin);
                            $('#ExitPrice').val(arr.ExitPrice);
                            $('.layui-upload-img_md').attr('src',arr.CardUIURL);
                            $('#barthdayFreeCoin').val(arr.BirthdayFreeCoin);
                            $('#freeNeedWin').val(arr.FreeNeedWin);
                            $('#freeCoin').val(arr.FreeCoin);
                            $('#minExitCoin').val(arr.MinExitCoin);

                            $('#demo2') .append('<div style="display: inline-block;position: relative" class="imgBox">' +
                                '<button type="button" ><i class="layui-icon"><i class="layui-icon">&#xe640</i></i></button>' +
                                '<img src="'+ arr.CardUIURL +'" class="layui-upload-img_md" ' +
                                'style="display: block;width: 300px;height: 170px"></div>');
                            $('.imgBox button').click(function () {
                                $(this).parent('div').remove();
                            });
                            $('.imgBox img').click(function () {
                                layer.open({
                                    title:'查看大图',
                                    type: 1,
                                    area: ['600px','400px'], //宽高
                                    content: '<div><img src="'+arr.CardUIURL+'" alt="" style="display: block;"></div>'
                                });
                            });
                            layer.open({
                                type:1,
                                area:'1000px',
                                shade:0.6,
                                content:$('#openModel')
                            });
                        }

                    }
                })
            }
        })

        var demoListViewStore=$('#demo2'),uploadListInsStore=upload.render({
            elem: '#imgBtn'
            ,url: '/XCCloud/Member?action=UploadCardCover'
            ,data:{'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'}
            ,multiple: true
            ,accept:"images"
            ,size:1000
            ,auto:true
            ,done: function(res,index,upload){
                //上传完毕
                console.log(res);
                if(res.result_code==1){
                    $('#demo2').children('div[class="imgBox"]').remove();
                    $('#demo2 .loadTips').addClass('layui-hide');
                    $('#demo2') .append('<div style="display: inline-block;position: relative" class="imgBox">' +
                        '<button type="button" ><i class="layui-icon"><i class="layui-icon">&#xe640</i></i></button>' +
                        '<img src="'+ res.result_data[0].Value +'" alt="'+ res.result_data[0].Value +'" class="layui-upload-img_md" ' +
                        'style="display: block;width: 300px;height: 170px"></div>');
                    layer.msg("图片上传成功！");
                    $('.imgBox button').click(function () {
                        $(this).parent('div').remove();
                    });
                    $('.imgBox img').click(function () {
                        layer.open({
                            title:  res.result_data.ID,
                            type: 1,
                            area: ['600px','400px'], //宽高
                            content: '<div><img src="'+res.result_data[0].Value+'" alt="" style="display: block;"></div>'
                        });
                    });
                }else{
                    layer.msg(res.return_msg);
                }
            }
            ,error:function(index,upload){
                layer.msg("服务器返回错误！");
                layer.closeAll('loading');
            }
        });
    }) ;

    layui.use('form', function(){
        var form = layui.form;
        form.on('select(mustInput)', function(data){
            option1=data.value;
        });
        form.on('select(freeRate)', function(data){
            option2=data.value;
            console.log(option2);
            console.log(data.value);
        });
        form.on('select(freeType)', function(data){
            option3=data.value;
        });
        form.on('select(barthdayFree)', function(data){
            option4=data.value;
        });
        form.on('switch(AllowExitCard)', function(data){
            data.elem.checked==true ? radiv1=1:radiv1=0;
        });
        form.on('switch(AllowExitMoney)', function(data){
            data.elem.checked==true ? radiv2=1:radiv2=0;
        });
        form.on('switch(LockHead)', function(data){
            data.elem.checked==true ? radiv3=1:radiv3=0;
        });
        form.on('switch(AllowExitCoinToCard)', function(data){
            data.elem.checked==true ? radiv4=1:radiv4=0;
        });
        form.on('switch(State)', function(data){
            data.elem.checked==true ? option5=1:option5=0;
        });
    });
    var saveML=()=>{

        let MemberLI=xc.getStorage('MemberLevelID')||"";
        let MemberLN=$('#levelNames').val();
        let Deposit=$('#deposit').val();
        let Validday=$('#validday').val();
        let ExitMoney=$('#ExitMoney').val();
        let ExitCoin=$('#ExitCoin').val();
        let ExitPrice=$('#ExitPrice').val();
        let BirthdayFreeCoin=$('#barthdayFreeCoin').val();
        let MustInput=option1;
        let BirthdayFree=option4;
        let FreeType=option3;
        let FreeNeedWin=$('#freeNeedWin').val();
        let FreeCoin=$('#freeCoin').val();
        let FreeRate=option2;
        let AllowExitCard=radiv1;
        let AllowExitMoney=radiv2;
        let AllowExitCoinToCar=radiv4;
        let LockHead=radiv3;
        let States=option5;
        let imgUrl=$('.layui-upload-img_md').attr('src');
        let MinExitCoin=$('#minExitCoin').val();
        let obj={
            'MemberLevelID':MemberLI,
            'MemberLevelName':MemberLN,'Deposit':Deposit,'Validday':Validday,'BirthdayFreeCoin':BirthdayFreeCoin,'FreeNeedWin':FreeNeedWin,
            'ExitMoney':ExitMoney,'ExitCoin':ExitCoin,'State':States,'FreeCoin':FreeCoin,'MinExitCoin':MinExitCoin,'CardUIURL':imgUrl,
        'ExitPrice':ExitPrice,'MustInput':MustInput,'BirthdayFree':BirthdayFree,'FreeType':FreeType,'FreeRate':FreeRate,'AllowExitCard':AllowExitCard,
        'AllowExitMoney':AllowExitMoney,'AllowExitCoinToCard':AllowExitCoinToCar,'LockHead':LockHead,'userToken':token,
            'signkey':'1f626576304bf5d95b72ece2222e42c3'};
        let url='/XCCloud/Member?action=SaveMemberLevel';
        let  parseJson=JSON.stringify(obj);
        console.log(parseJson);
        $.ajax({
            type:'post',
            url:url,
            contentType: "application/json; charset=utf-8",
            data: { parasJson: parseJson },
            success:(data)=>{
                data=JSON.parse(data);
                if(data.result_code=="1"){
                    layui.use('layer', function(){
                        var layer = layui.layer;
                        layer.msg('操作成功！');
                        layer.closeAll();
                        $('#mlBtn').trigger('click');
                    });
                }else {
                    layui.use('layer', function(){
                        var layer = layui.layer;
                        layer.msg(data.result_msg);
                    });
                }
            }
        })
    };

</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-sm layui-btn-danger" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-sm layui-btn-danger" lay-event="del">删除</a>
</script>
</html>