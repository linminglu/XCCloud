<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>礼品调拨</title>
    <link rel="stylesheet" href="layui/css/layui.css">
</head>
<body>
    <div class="layui-row">
        <blockquote class="layui-elem-quote" style="text-align:right; padding-right: 100px;">
            <button type="button" id="applyBtn" class="layui-btn layui-btn-normal">申请</button>
            <button type="button" id="searchBtn" class="layui-btn layui-btn-normal">查询</button>
        </blockquote>
        <table class="layui-hide" lay-filter="giftAllocationTB" id="giftAllocationTB"></table>
    </div>
<!--弹窗1-->
    <div id="openModel" style="display:none; padding: 15px;">
        <form action="" class="layui-form layui-form-pane">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label for="" class="layui-form-label">申请仓库</label>
                    <div class="layui-input-inline">
                        <select name="" id=""></select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label for="" class="layui-form-label">调拨方式</label>
                    <div class="layui-input-inline">
                        <select name="" id="">
                            <option value="0">门店间申请</option>
                            <option value="1">总部派发</option>
                            <option value="2">总部申请</option></select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label for="" class="layui-form-label">调拨门店</label>
                    <div class="layui-input-inline">
                        <select name="" id=""></select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
               <!--<div class="layui-inline">-->
                   <label for="" class="layui-form-label">调拨原因</label>
                   <div class="layui-input-block" style="width: 838px">
                       <input type="text" class="layui-input">
                   </div>
               <!--</div>-->
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label for="" class="layui-form-label">物流公司</label>
                    <div class="layui-input-inline">
                        <select name="" id=""></select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label for="" class="layui-form-label">物流单号</label>
                   <div class="layui-input-inline">
                       <input type="text" class="layui-input">
                   </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <div class="layui-input-inline" style="width: 300px;">
                        <input type="text" class="layui-input" placeholder="请输入商品条码或者名称">
                    </div>
                   <div class="layui-input-inline">
                       <button type="button" id="searchGoodBtn" class="layui-btn layui-btn-normal"><i class="layui-icon">&#xe615;</i></button>
                   </div>
                </div>
            </div>
            <table class="layui-hide" id="giftsList" lay-filter="giftsList"></table>
            <div style="text-align:right;padding-right: 100px;">
                <button type="button" id="save" class="layui-btn layui-btn-normal">确定</button>
            </div>
        </form>
    </div>
<!--弹窗2-->
    <div id="goodsBox">
        <table class="layui-hide" id="goodsList" lay-filter="goodsList"></table>
    </div>
</body>
<script src="js/jquery-1.8.3-min.js"></script>
<script src="layui/layui.js"></script>
<script src="js/storeSystem.js"></script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit"><i class="layui-icon">&#xe642;</i>修改</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="check"><i class="layui-icon">&#xe640;</i>审核</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="handle"><i class="layui-icon">&#xe640;</i>处理</a>
</script>
<script>
    let xc=xcActionSystem.prototype;
    let token=xc.getStorage('token');
    let parm={'obj':{'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'},
        'url':'/XCCloud/DepotInfo?action=QueryDepotInfo',
        'elem':'#warehouseManage',
        'cols':[
             {field:'ID', title:'申请时间', align: 'center', sort: true}
            ,{field:'DepotName',title: '申请门店', align: 'center'}
            ,{field:'MinusEN', title: '申请人', align: 'center',templet:'#changeMinusEN'}
            ,{field:'StoreName', title: '申请仓库', align: 'center'}
            ,{field:'StoreName', title: '调拨方式', align: 'center'}
            ,{field:'StoreName', title: '调拨状态', align: 'center'}
            ,{field:'StoreName', title: '调拨门店', align: 'center'}
            ,{field:'StoreName', title: '调拨仓库', align: 'center'}
            ,{field:'StoreName', title: '调拨时间', align: 'center'}
            ,{field:'StoreName', title: '调拨说明', align: 'center'}
            ,{fixed: 'right', title: '操作', width:260, align:'center', toolbar: '#barDemo'}]
    };
    xc.getInitData(parm);

    layui.use(['form','table','layer'],function () {
            let form=layui.form;
            let table=layui.table;
            let layer=layui.layer;
            //监听选中商品
            table.on('checkbox(goodsList)', function(obj){
                if (obj.type == "all") {
                    var csss = $(".layui-table-cell.laytable-cell-checkbox");
                    csss.each(function(index, e){
                        e.children[0].checked = false;
                        e.children[1].className="layui-unselect layui-form-checkbox";
                        checkListGoods=[];
                    });
                } else {
                    if(obj.checked==true){
                        checkListGoods=[{'foodDetailType':2,'ProjectName': obj.data.GoodName,'FoodTypeStr':'商品',
                            'ContainID':obj.data.ID,'WeightValue':obj.data.Price,'ContainCount':1,'Days':''}]
                    }else {
                        checkListGoods=[];
                    }
                    var csss = $(".layui-table-cell.laytable-cell-checkbox");
                    csss.each(function(index, e){
                        var dataIndex = e.parentNode.parentNode.getAttribute("data-index");
                        if (dataIndex != null) {
                            if(dataIndex != obj.data.LAY_TABLE_INDEX){
                                e.children[0].checked = false;
                                e.children[1].className="layui-unselect layui-form-checkbox";
                            }
                        } else {
                            e.children[0].checked = false;
                            e.children[1].className="layui-unselect layui-form-checkbox";
                        }
                    });
                }
            });
            //弹出层
            $('#applyBtn').on('click',function () {
                layer.open({
                    title:'申请记录',
                    type:1,
                    area:'1000px',
                    content:$('#openModel')
                });
                initGoodsTb();
            });
            $('#searchGoodBtn').on('click',function () {
                layer.open({
                    title:'库存礼品列表',
                    type:1,
                    area:'1000px',
                    content:$('#goodsBox')
                });
                initGoodsTb();
            });
            let arr=[{'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},
                {'SaleTime':'2018-3-15','DigitNumber':'200','DigitName':'七号数字币','Count':40,'Money':'499','SaleMachine':'售币机'},];
            layui.table.render({
                elem: '#giftAllocationTB'
                , data: arr
                // , size:'sm'
                , cellMinWidth: 120 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                , cols: [[{field:'SaleTime', title:'商品条码', align: 'center'}
                    ,{field:'DigitNumber',title: '商品类别', align: 'center'} //width 支持：数字、百分比和不填写。
                    ,{field:'DigitName', title: '商品名称', align: 'center',templet:'#prob'}
                    ,{field:'Count', title: '调配时间', align: 'center'}
                    ,{field:'Money', title: '申请门店', align: 'center'}
                    ,{field:'SaleMachine', title: '申请仓库', align: 'center'}
                    ,{field:'SaleMachine', title: '调配门店', align: 'center',edit: 'text'}
                    ,{field:'SaleMachine', title: '调配说明', align: 'center',edit: 'text'}
                    ,{field:'SaleMachine', title: '调配结果', align: 'center',edit: 'text'}
                    ,{fixed: 'right',title: '操作' ,width:200, align:'center', toolbar: '#barDemo'}]]
                , page: {page: true, limits: [5,10, 15, 20, 30, 50, 100]}
                , limit: 10
            });


        })

    function initGoodsTb() {
        var searchText=$('#searchText').val();
        var parm={'obj':{'goodNameOrBarcode':searchText,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'},
            'url':'/XCCloud/Promotion?action=GetGoodsInfoList',
            'elem':'#goodsList',
            'height':'210px',
            'cols':[ {field:'ID', title: '商品ID', align: 'center'}
                ,{field:'Barcode', title: '商品条码', align: 'center'}
                ,{field:'GoodName', title: '商品名称', align: 'center'}
                ,{field:'GoodTypeStr', title: '商品类别', align: 'center'}
                ,{field:'Points', title: '申请数量', align: 'center',edit: 'text'}
                ,{field:'Price', title: '库存', align: 'center',edit: 'text'}
                ,{type:'checkbox'}
            ]};
        xc.getInitData(parm);
    }
</script>
</html>