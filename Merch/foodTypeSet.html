<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>套餐类别设定</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="layui/css/layui_font.css">
    <link rel="stylesheet" href="css/demo.css">
    <link rel="stylesheet" href="css/iconfont.css">
</head>
<style>
    .name, .fontclass{
        display: none;
    }
    .main .clear li{
        cursor: pointer;
        width: 60px;
        height: 60px;
        margin: 8px;
        background-color: #93D1FF;
    }
    .main .clear li i{
        display: block;vertical-align: top;
        margin: 0;
        line-height: 60px;
    }
    .addImg{
        display: block;
        width: 60px;
        height: 60px;
        margin-left: 65px;
        font-size: 40px;
        color: #9F9F9F;
    }
</style>
<body>
<div class="layui-row" style="padding: 15px;">
    <blockquote class="layui-elem-quote" style="text-align:right;padding-right: 50px;">
        <button type="button" class="layui-btn">查询</button>
        <button type="button" class="layui-btn" id="add">新增</button>
    </blockquote>
    <table class="layui-hide" id="foodTypeTable" lay-filter="foodTypeTable"></table>
</div>
<!--新增规则-->
<div id="openModel" style="padding: 15px;display: none" class="goodIsAll">
    <form action="" class="layui-form layui-form-pane" lay-filter="formtest">
        <div class="layui-form-item">
            <label  class="layui-form-label" style="padding: 8px 0">套餐类别名称</label>
            <div class="layui-input-block" >
                <input type="text" class="layui-input" name="dictKey">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label  class="layui-form-label" style="height: 60px">默认图标</label>
                <div class="layui-input-inline" style="height: 58px;border: 1px solid #e6e6e6;margin: 0 auto">
                    <i class="addImg icon iconfont icon-icon_jia"id="primaryImg" >

                    </i>
                </div>
            </div>
            <!--<div class="layui-inline">-->
                <!--<label  class="layui-form-label" style="height: 60px">选中时图标</label>-->
                <!--<div class="layui-input-inline" style="height: 58px;border: 1px solid #e6e6e6;padding: 0 auto">-->
                    <!--<i  class="addImg icon iconfont icon-icon_jia"  id="activeImg">-->

                    <!--</i>-->
                <!--</div>-->
            <!--</div>-->
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <input type="checkbox" checked title="是否显示" name="enabled" lay-filter="enabled" lay-skin="primary">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label  class="layui-form-label">说明</label>
            <div class="layui-input-block">
                <input type="text" class="layui-input" name="comment">
            </div>
        </div>
    </form>
    <div class="layui-col-md12" style="text-align:center;margin-bottom: 15px;">
        <button type="button" class="layui-btn" id="save">确定</button>
    </div>
</div>

<div id="imgBox" class="main markdown" style="display: none">
    <ul class="icon_lists clear">

        <li>
            <i class="icon iconfont icon-icon2"></i>
            <div class="name">全部</div>
            <div class="fontclass">.icon-icon2</div>
        </li>

        <li>
            <i class="icon iconfont icon-dingdanchaxun"></i>
            <div class="name">订单查询</div>
            <div class="fontclass">.icon-dingdanchaxun</div>
        </li>

        <li>
            <i class="icon iconfont icon-icon3"></i>
            <div class="name">商品</div>
            <div class="fontclass">.icon-icon3</div>
        </li>

        <li>
            <i class="icon iconfont icon-jian"></i>
            <div class="name">jian</div>
            <div class="fontclass">.icon-jian</div>
        </li>

        <li>
            <i class="icon iconfont icon-duqiaqi"></i>
            <div class="name">读卡器</div>
            <div class="fontclass">.icon-duqiaqi</div>
        </li>

        <li>
            <i class="icon iconfont icon-quanbu-copy"></i>
            <div class="name">全部</div>
            <div class="fontclass">.icon-quanbu-copy</div>
        </li>

        <li>
            <i class="icon iconfont icon-3"></i>
            <div class="name">键盘</div>
            <div class="fontclass">.icon-3</div>
        </li>

        <li>
            <i class="icon iconfont icon-2"></i>
            <div class="name">商品</div>
            <div class="fontclass">.icon-2</div>
        </li>

        <li>
            <i class="icon iconfont icon-iconjia"></i>
            <div class="name">icon_jia</div>
            <div class="fontclass">.icon-iconjia</div>
        </li>

        <li>
            <i class="icon iconfont icon-libao"></i>
            <div class="name">礼包</div>
            <div class="fontclass">.icon-libao</div>
        </li>

        <li>
            <i class="icon iconfont icon-touxiang"></i>
            <div class="name">头像</div>
            <div class="fontclass">.icon-touxiang</div>
        </li>

        <li>
            <i class="icon iconfont icon-wodedaibi"></i>
            <div class="name">我的代币</div>
            <div class="fontclass">.icon-wodedaibi</div>
        </li>

        <li>
            <i class="icon iconfont icon-ticket"></i>
            <div class="name">门票</div>
            <div class="fontclass">.icon-ticket</div>
        </li>

        <li>
            <i class="icon iconfont icon-peitongruxue"></i>
            <div class="name">陪同入学</div>
            <div class="fontclass">.icon-peitongruxue</div>
        </li>

        <li>
            <i class="icon iconfont icon-menpiao"></i>
            <div class="name">门票</div>
            <div class="fontclass">.icon-menpiao</div>
        </li>

        <li>
            <i class="icon iconfont icon-shenfenzhengrenzheng"></i>
            <div class="name">身份证认证</div>
            <div class="fontclass">.icon-shenfenzhengrenzheng</div>
        </li>

        <li>
            <i class="icon iconfont icon-huiyuanqia"></i>
            <div class="name">会员卡</div>
            <div class="fontclass">.icon-huiyuanqia</div>
        </li>

        <li>
            <i class="icon iconfont icon-jingdianmenpiao"></i>
            <div class="name">景点门票</div>
            <div class="fontclass">.icon-jingdianmenpiao</div>
        </li>

        <li>
            <i class="icon iconfont icon-youxi"></i>
            <div class="name">游戏</div>
            <div class="fontclass">.icon-youxi</div>
        </li>

        <li>
            <i class="icon iconfont icon-lipinhuigou"></i>
            <div class="name">礼品回购</div>
            <div class="fontclass">.icon-lipinhuigou</div>
        </li>

        <li>
            <i class="icon iconfont icon-icon"></i>
            <div class="name">过户</div>
            <div class="fontclass">.icon-icon</div>
        </li>

        <li>
            <i class="icon iconfont icon-icon1"></i>
            <div class="name">等级</div>
            <div class="fontclass">.icon-icon1</div>
        </li>

        <li>
            <i class="icon iconfont icon-youxi1"></i>
            <div class="name">游戏</div>
            <div class="fontclass">.icon-youxi1</div>
        </li>

        <li>
            <i class="icon iconfont icon-touxiang1"></i>
            <div class="name">头像</div>
            <div class="fontclass">.icon-touxiang1</div>
        </li>

        <li>
            <i class="icon iconfont icon-jishi"></i>
            <div class="name">计时</div>
            <div class="fontclass">.icon-jishi</div>
        </li>

        <li>
            <i class="icon iconfont icon-huaban"></i>
            <div class="name">门票首页</div>
            <div class="fontclass">.icon-huaban</div>
        </li>

        <li>
            <i class="icon iconfont icon-dingdanchaxun1"></i>
            <div class="name">订单查询</div>
            <div class="fontclass">.icon-dingdanchaxun1</div>
        </li>

        <li>
            <i class="icon iconfont icon-libao1"></i>
            <div class="name">礼包</div>
            <div class="fontclass">.icon-libao1</div>
        </li>

        <li>
            <i class="icon iconfont icon-jiabi"></i>
            <div class="name">加币</div>
            <div class="fontclass">.icon-jiabi</div>
        </li>

        <li>
            <i class="icon iconfont icon-icon_jia"></i>
            <div class="name">icon_jia</div>
            <div class="fontclass">.icon-icon_jia</div>
        </li>

        <li>
            <i class="icon iconfont icon-ziyuan"></i>
            <div class="name">吧台服务</div>
            <div class="fontclass">.icon-ziyuan</div>
        </li>

        <li>
            <i class="icon iconfont icon-shangpin"></i>
            <div class="name">商品</div>
            <div class="fontclass">.icon-shangpin</div>
        </li>

        <li>
            <i class="icon iconfont icon-menpiaohexiaomingxi"></i>
            <div class="name">门票核销明细</div>
            <div class="fontclass">.icon-menpiaohexiaomingxi</div>
        </li>

        <li>
            <i class="icon iconfont icon-tuijian"></i>
            <div class="name">游戏</div>
            <div class="fontclass">.icon-tuijian</div>
        </li>

        <li>
            <i class="icon iconfont icon-menpiao1"></i>
            <div class="name">门票</div>
            <div class="fontclass">.icon-menpiao1</div>
        </li>

        <li>
            <i class="icon iconfont icon-libao2"></i>
            <div class="name">礼包</div>
            <div class="fontclass">.icon-libao2</div>
        </li>

        <li>
            <i class="icon iconfont icon-touxiang2"></i>
            <div class="name">头像</div>
            <div class="fontclass">.icon-touxiang2</div>
        </li>

        <li>
            <i class="icon iconfont icon-jiaobanguanli"></i>
            <div class="name">交班管理</div>
            <div class="fontclass">.icon-jiaobanguanli</div>
        </li>

        <li>
            <i class="icon iconfont icon-jiaobanbaobiao"></i>
            <div class="name">交班报表</div>
            <div class="fontclass">.icon-jiaobanbaobiao</div>
        </li>

        <li>
            <i class="icon iconfont icon-huiyuanqia1"></i>
            <div class="name">会员卡</div>
            <div class="fontclass">.icon-huiyuanqia1</div>
        </li>

        <li>
            <i class="icon iconfont icon-neishiqingli"></i>
            <div class="name">内饰清理</div>
            <div class="fontclass">.icon-neishiqingli</div>
        </li>

        <li>
            <i class="icon iconfont icon-sousuo"></i>
            <div class="name">搜索</div>
            <div class="fontclass">.icon-sousuo</div>
        </li>

        <li>
            <i class="icon iconfont icon-dengji"></i>
            <div class="name">等级</div>
            <div class="fontclass">.icon-dengji</div>
        </li>

        <li>
            <i class="icon iconfont icon-btnMsg"></i>
            <div class="name">消息</div>
            <div class="fontclass">.icon-btnMsg</div>
        </li>

        <li>
            <i class="icon iconfont icon-chongzhi"></i>
            <div class="name">充值</div>
            <div class="fontclass">.icon-chongzhi</div>
        </li>

        <li>
            <i class="icon iconfont icon-batai"></i>
            <div class="name">吧台</div>
            <div class="fontclass">.icon-batai</div>
        </li>

        <li>
            <i class="icon iconfont icon-shouye-xinyongqiaguashi"></i>
            <div class="name">首页-信用卡挂失</div>
            <div class="fontclass">.icon-shouye-xinyongqiaguashi</div>
        </li>

        <li>
            <i class="icon iconfont icon-shuzibi_jiaoyiguanli"></i>
            <div class="name">数字币_交易管理</div>
            <div class="fontclass">.icon-shuzibi_jiaoyiguanli</div>
        </li>

        <li>
            <i class="icon iconfont icon-qinglikehu"></i>
            <div class="name">清理客户</div>
            <div class="fontclass">.icon-qinglikehu</div>
        </li>

        <li>
            <i class="icon iconfont icon-guquandaibi"></i>
            <div class="name">股权代币</div>
            <div class="fontclass">.icon-guquandaibi</div>
        </li>

    </ul>
</div>

</div>
</body>
<script src="js/jquery-1.8.3-min.js"></script>
<script src="layui/layui.js"></script>
<script src="js/storeSystem.js"></script>
<script>
    var xc=xcActionSystem.prototype;
    var token=xc.getStorage('token');
    let parm={'obj':{'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'},
        'url':'/XCCloud/FoodType?action=QueryFoodType',
        'elem':'#foodTypeTable',
        'cols':[
            {field:'ID', title:'ID', align: 'center', sort: true}
            // ,{field:'OrderID', title: '类别编号', align: 'center'}
            ,{field:'DictKey', title: '套餐类别名称', align: 'center'}
            ,{field:'Enabled', title: '状态', align: 'center',templet:'#enabled'}
            ,{field:'Icon', title: '图标', align: 'center',templet:function (d) {
                    if(d.Icon!=null&&d.Icon!=''){
                        return '<i class="icon iconfont '+d.Icon+'"></i>'
                    }else {
                        return '<i class="icon iconfont icon-tuijian"></i>'
                    }
                }}
            ,{field:'Comment', title: '说明', align: 'center'}
            ,{fixed: 'right', title: '操作', width:240, align:'center', toolbar: '#barDemo'}
        ]
    };
    xc.getInitData(parm);
    let id='';let enabled=1;
    let imgStatus='';let indexImg;
    layui.use(['form','table','layer'],function () {
        let form=layui.form;
        let table=layui.table;
        let layer=layui.layer;
        form.on('checkbox(enabled)',function (data) {
            if(data.elem.checked){
                enabled=1;
            }else {
                enabled=0;
            }
        });
        $('#add').click(function () {
            id='';
            layer.open({
                title:'新增套餐类型',
                type:1,
                area:'700px',
                content:$('#openModel')
            })
        });
        $('#save').click(function () {
            let arr=[];
            arr=$('#primaryImg').attr('class').split(' ')
            let obj={'id':id,
            'dictKey':$('input[name="dictKey"]').val(),
            'comment':$('input[name="comment"]').val(),
            'enabled':enabled,
                'icon':arr[3],
            'userToken':token,
            'signkey':'1f626576304bf5d95b72ece2222e42c3'};
            let parasJson = JSON.stringify(obj);
            $.ajax({
                type: "post",
                url: '/XCCloud/FoodType?action=SaveFoodType',
                contentType: "application/json; charset=utf-8",
                data: {parasJson: parasJson},
                success: function (data) {
                    data = JSON.parse(data);
                    if(data.result_code==1){
                        layer.msg('保存成功！',{time:1500},function () {
                            location.reload();
                        })
                    }else {
                        layer.msg(data.result_msg)
                    }
                }
            })
        });

        $('.addImg').click(function () {
            imgStatus=$(this).attr('id');

         indexImg=  layer.open({
               title:"图片库",
               area:'800px',
               type:1,
               content:$('#imgBox')
           })
        });
        $('#imgBox').on('click','ul li',function () {
            let str=$(this).find('div.fontclass').text();
            str=str.substring(1,str.length);
            let classStr=$('#'+imgStatus).attr('class');
            let arr=classStr.split(' ');
            arr.splice(3,1)
            arr.push(str);
            $('#'+imgStatus).attr('class',arr.join(' '));

            layer.close(indexImg);
        });
        table.on('tool(foodTypeTable)',function (obj) {
            let _data=obj.data;
            let layevent=obj.event;
            id=_data.ID;
            if(layevent==='del'){
                layer.confirm('确定删除该规则吗', function(index){
                    let _obj={'id':[_data.ID],'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type:'post',
                        url:'/XCCloud/FoodType?action=DelFoodType',
                        contentType: "application/json; charset=utf-8",
                        data:{parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                                layer.msg('删除成功',{time:1500},function () {
                                    location.reload();
                                });
                            } else {
                                layer.msg(data.result_msg||return_msg);
                            }
                        }
                    })
                })
            }else if(layevent==='upLevel'){
                layer.confirm('确定升级该规则吗', function(index){
                    let _obj={'id':_data.ID,'orderState':-1,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type:'post',
                        url:'/XCCloud/FoodType?action=OrderFoodType',
                        contentType: "application/json; charset=utf-8",
                        data:{parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                                layer.msg('升序成功',{time:1500},function () {
                                    location.reload();
                                });
                            } else {
                                layer.msg(data.result_msg||return_msg);
                            }
                        }
                    })
                })
            }else if(layevent==='downLevel'){
                layer.confirm('确定降级该规则吗', function(index){
                    let _obj={'id':_data.ID,'orderState':1,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type:'post',
                        url:'/XCCloud/FoodType?action=OrderFoodType',
                        contentType: "application/json; charset=utf-8",
                        data:{parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                                layer.msg('降序成功',{time:1500},function () {
                                    location.reload();
                                });
                            } else {
                                layer.msg(data.result_msg||return_msg);
                            }
                        }
                    })
                })
            }else if(layevent==='edit'){

                    let _obj={'id':_data.ID,'userToken':token,'signkey':'1f626576304bf5d95b72ece2222e42c3'};
                    let parseJson = JSON.stringify(_obj);
                    $.ajax({
                        type:'post',
                        url:'/XCCloud/FoodType?action=GetFoodType',
                        contentType: "application/json; charset=utf-8",
                        data:{parasJson: parseJson},
                        success: function (data) {
                            data = JSON.parse(data);
                            if (data.result_code == 1) {
                                console.log(data)
                                id=_data.ID;
                                $('input[name="dictKey"]').val(data.result_data.DictKey)
                                if(data.result_data.Icon!=null){
                                    $('#primaryImg').attr('class','addImg icon iconfont').addClass(data.result_data.Icon)
                                }

                                if(data.result_data.Enabled==1){
                                    $('input[name="enabled"]').attr('checked',true)
                                }else {
                                    $('input[name="enabled"]').attr('checked',false)
                                }
                                enabled=data.result_data.Enabled;
                                $('input[name="comment"]').val(data.result_data.Comment)
                                form.render()
                                layer.open({
                                    title:'新增套餐类型',
                                    type:1,
                                    area:'700px',
                                    content:$('#openModel')
                                })
                            } else {
                                layer.msg(data.result_msg||return_msg);
                            }
                        }
                    })

            }
        })
    })
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="upLevel">升序</a>
    <a class="layui-btn layui-bg-orange layui-btn-xs" lay-event="downLevel">降序</a>
</script>
<script type="text/html" id="enabled">
    {{# if(d.Enabled==1){ }}
    <input type="checkbox" checked name="switch" lay-skin="switch" lay-text="启用|不启用" class="tb_check" lay-filter="test" disabled>
    {{# }else{ }}
    <input type="checkbox" name="switch" lay-skin="switch" lay-text="启用|不启用" class="tb_check" lay-filter="test" disabled>
    {{#  } }}
</script>
</html>