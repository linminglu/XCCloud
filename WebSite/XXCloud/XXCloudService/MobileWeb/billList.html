<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>莘拍档</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/ydui.rem.css">
    <!-- 引入rem自适应类库 -->

    <style>

    </style>
</head>
<body>

<div id="app">
    <yd-button @click.native="payBtn" size="large">Confirm</yd-button>
    <yd-button @click.native="payBtnTest" size="large">payBtnTest</yd-button>
</div>
<script src="js/ydui.flexible.js"></script>
<!-- 引入 Vue -->
<script src="js/vue.js"></script>
<script src="js/jquery-1.8.3-min.js"></script>
<!-- 引入组件库 -->
<script src="js/ydui.rem.js"></script>
<script src="js/axios.min.js"></script>
<script src="https://gw.alipayobjects.com/as/g/h5-lib/alipayjsapi/3.1.0/alipayjsapi.min.js"></script>
<script>
    var sysId = 0; //调用方应用Id
    var versionNo= "0.89"; //版本号
    var url_getPposWxPay = '/Payment?action=getPposWxPay';//获取分页订单列表
    var htmlfnc = new Vue({
        el: '#app',
        data:{
            mobileToken:''
        },
        mounted: function () {

        },
        methods: {
            Load:function () {
            },
            payBtn:function () {
                var that =this;
                if (/MicroMessenger/.test(window.navigator.userAgent)) {
                    var obj={"sysId": "0","versionNo": "0.0.0.1",mobileToken:"335abf03a9b346b6bc5d64ec83b89dfd",openId:"oNWocwWOI7tJGRIx1x3oeBB5xnLs",storeId:"100027",buyType:"充值",productName:"5币套餐",payPrice:0.01,coins:"5"};
                    that.$dialog.loading.open();
                    axios.post(url_getPposWxPay, obj).then(function (res) {
                        that.$dialog.loading.close();
                        console.log(res.data);
                        that.msgPrompt(res.data);
                        if (res.data.result_code === '1') {
                            WeixinJSBridge.invoke(
                                'getBrandWCPayRequest',
                                {
                                    "appId": res.data.result_data.appId,     //公众号名称，由商户传入
                                    "timeStamp": res.data.result_data.timeStamp,         //时间戳，自1970年以来的秒数
                                    "nonceStr": res.data.result_data.nonceStr, //随机串
                                    "package": res.data.result_data.package,
                                    "signType": "MD5",         //微信签名方式：
                                    "paySign": res.data.result_data.paySign //微信签名
                                },
                                function (res) {
//                                    alert(JSON.stringify(res));
                                    if (res.err_msg == "get_brand_wcpay_request:ok") {
                                        that.$dialog.toast({
                                            mes: "付款成功!",
                                            timeout:1500,
                                            icon: 'success'
                                        });
                                    }
                                }
                            );
                        }
                    }).catch(function (err) {
                        that.$dialog.loading.close();
                        console.log(err);
                    })
                } else if (/AlipayClient/.test(window.navigator.userAgent)) {
                    var obj={"sysId": "0","versionNo": "0.0.0.1",mobileToken:"335abf03a9b346b6bc5d64ec83b89dfd",aliId:"2088012003061467",storeId:"100027",buyType:"充值",productName:"5币套餐",payPrice:0.01,coins:"5"};
                    that.$dialog.loading.open();
                    axios.post("/Payment?action=createAlipayOrder", obj).then(function (res) {
                        that.$dialog.loading.close();
                        console.log(res.data);
                        that.msgPrompt(res.data);
                        if (res.data.result_code === '1') {
                            AlipayJSBridge.call("tradePay", {
                                tradeNO: res.data.result_data.tradeNO
                            }, function(result) {
//                                alert(JSON.stringify(result));
                                if(result.resultCode == "9000"){
                                    that.$dialog.toast({
                                        mes: "付款成功!",
                                        timeout:1500,
                                        icon: 'success'
                                    });
                                }else if(result.resultCode == "6001"){
                                    that.$dialog.toast({
                                        mes: "取消支付!",
                                        timeout:1500,
                                        icon: 'error'
                                    });
                                }else if(result.resultCode == "6002"){
                                    that.$dialog.toast({
                                        mes: "网络出错!",
                                        timeout:1500,
                                        icon: 'error'
                                    });
                                }else {
                                    that.$dialog.toast({
                                        mes: "订单支付失败!",
                                        timeout: 1500,
                                        icon: 'error'
                                    });
                                }
//                            alert(JSON.stringify(result));
                            });
                        }
                    }).catch(function (err) {
                        that.$dialog.loading.close();
                        console.log(err);
                    })
                } else {
                    that.$dialog.toast({
                        mes: "暂不支持此浏览器支付!",
                        timeout:1500,
                        icon: 'error'
                    });
                    console.log("")
                }

            },
            payBtnTest:function () {
                var that =this;


            },
            msgPrompt:function (res) {
                if(res.return_code == 0){
                    this.$dialog.toast({
                        mes: res.return_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }else if(res.result_code == 0){
                    this.$dialog.toast({
                        mes: res.result_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }
            }
        }
    });
</script>
</body>
</html>