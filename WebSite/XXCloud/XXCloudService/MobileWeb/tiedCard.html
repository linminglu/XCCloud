<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>莘拍档</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/ydui.rem.css">
    <!-- 引入 Vue -->
    <script src="js/vue.js"></script>
    <!-- 引入rem自适应类库 -->
    <script src="js/ydui.rem.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <yd-cell-group>
        <yd-cell-item>
            <img class="itemImg" slot="icon" src="images/member.png">
            <input slot="right" type="number" placeholder="会员卡号码" v-model="icCardId" v-on:blur="inputCardId" oninput="if(value.length>15)value=value.slice(0,15)">
        </yd-cell-item>
    </yd-cell-group>
    <yd-cell-group>
        <yd-cell-item>
            <img class="itemImg" slot="icon" src="images/account.png">
            <input slot="right" type="number" placeholder="请输入手机号" v-model="mobile" v-on:blur="inputPrompt" oninput="if(value.length>11)value=value.slice(0,11)">
        </yd-cell-item>
    </yd-cell-group>
    <!--<yd-cell-group>-->
        <!--<yd-cell-item>-->
            <!--<img class="itemImg" slot="icon" src="images/IdCard.png">-->
            <!--<input slot="right" type="number" placeholder="身份证号" v-model="IdCard" v-on:blur="inputIdCard" oninput="if(value.length>18)value=value.slice(0,18)">-->
        <!--</yd-cell-item>-->
    <!--</yd-cell-group>-->
    <!--<yd-cell-group>-->
        <!--<yd-cell-item>-->
            <!--<yd-icon slot="icon" name="phone3" size=".45rem"></yd-icon>-->
            <!--<input type="text" slot="right" placeholder="请输入短信验证码" v-model="smsCode">-->
            <!--<yd-sendcode slot="right"-->
                         <!--v-model="start"-->
                         <!--second="30"-->
                         <!--@click.native="sendCode"-->
                         <!--type="warning"-->
            <!--&gt;</yd-sendcode>-->
        <!--</yd-cell-item>-->
    <!--</yd-cell-group>-->
    <yd-button size="large" type="primary" @click.native="tiedCard">绑定</yd-button>
</div>


<script src="js/jquery-1.8.3-min.js"></script>
<!-- 引入组件库 -->
<script src="js/ydui.flexible.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/alipayjsapi.min.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
    var sysId = 0; //调用方应用Id
    var versionNo= "0.89"; //版本号
    var htmlfnc = new Vue({
        el: '#app',
        data:{
            icCardId:"28801810",
            userThirdId : "oNWocwSC_GFO8n_8mtZ0iV9tL0WI",
            mobile:"",
            smsCode:""
        },
        mounted: function () {
            this.Load();
        },
        methods: {
            Load:function () {
                var that =this;
                var userThirdId = getStorage("userThirdId")||"";     //获取第三方令牌
                that.userThirdId = userThirdId;
            },
//          卡号输入
            inputCardId:function () {
                var that = this;
                var obj={sysId: sysId,versionNo: versionNo, token:that.userThirdId,icCardId:that.icCardId};
                axios.post('/XCCloudH5/Member?action=VerifyCard', obj).then(function (res) {
                    that.$dialog.loading.close();
                    that.msgPrompt(res.data);
                    console.log(res.data);
                    JSON.stringify(res.data);
                    if (res.data.result_code === '1') {

                    }
                }).catch(function (err) {
                    that.$dialog.loading.close();
                    console.log(err);
                })
            },
            inputPrompt:function () {

            },
//          绑定卡
            tiedCard:function () {
                var that = this;
                var obj={sysId: sysId,versionNo: versionNo, token:that.userThirdId,icCardId:that.icCardId,mobile:that.mobile,smsCode:that.smsCode};
                axios.post('/XCCloudH5/Member?action=BindCard', obj).then(function (res) {
                    that.$dialog.loading.close();
                    that.msgPrompt(res.data);
                    console.log(res.data);
                    JSON.stringify(res.data);
                    if (res.data.result_code === '1') {

                    }
                }).catch(function (err) {
                    that.$dialog.loading.close();
                    console.log(err);
                })
            },
//          通用报错提示
            msgPrompt:function (res) {
                if(res.return_code == 0){
                    this.$dialog.toast({
                        mes: res.return_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }else if(res.result_code == 0){
                    this.$dialog.toast({
                        mes: res.result_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }
            }
        }
    });
    //存储session
    function setStorage(key,value) {
        if(window.localStorage){
            value = JSON.stringify(value); //转化为JSON字符串
            var storage=window.localStorage;
            storage.setItem(key,value);
        }
    }
    //删除session
    function removeStorage(key) {
        if(window.localStorage){
            var storage=window.localStorage;
            storage.removeItem(key);
        }
    }
    //获取session
    function getStorage(key) {
        if(window.localStorage){
            value = JSON.parse(localStorage.getItem(key));
            return value;
        }
    }
</script>
</body>
</html>