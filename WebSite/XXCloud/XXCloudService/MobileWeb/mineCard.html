<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>莘拍档</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/ydui.rem.css">
    <!-- 引入rem自适应类库 -->
    <script src="js/ydui.flexible.js"></script>
    <style>
        .section_image{width: 1rem;height: 0.7rem;display: inline-block;margin-top: 0.36rem;}
        .section_items{display:flex;flex-direction: row;justify-content: space-between;padding:0.3rem;border-top:1px solid #ddd;position: relative;margin-top: 0.2rem;border-bottom: 0.01rem solid #1E90FF;}
        .section_cont{width:4rem;font-size:0.26rem;color:#a9a9a9;}
        .BuyCoins{display: inline-block;width:0.8rem;height:0.8rem;font-size:0.26rem;border-radius:100%;background:#d24a58;line-height: 0.8rem;color:#fff;text-align: center; margin-top:0.3rem;  }
        .hid_contSty{display: flex;flex-direction: row;margin-top: 0.1rem;}
        .hid_contStys{width: 1.6rem;text-align: left;color: #d24a58;}
        .cardIcon{width: 0.8rem;height: 0.8rem;margin-right: 0.1rem;}
        .iconSty{color: #1E90FF; line-height: 0.8rem;display: flex;flex-direction: row-reverse;font-size: 0.35rem;margin-top: 0.3rem;margin-right: 0.2rem;}
        [v-cloak] {
            display: none;
        }
        .width3{width:2.5rem;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;min-width: 2.5rem;max-width: 2.5rem;}
    </style>
</head>
<body>
<div id="app" v-cloak>
    <yd-navbar title="莘拍档">
        <router-link to="index.html" slot="left">
            <yd-navbar-back-icon>返回</yd-navbar-back-icon>
        </router-link>
        <!--<router-link to="#" slot="right">-->
            <!--<yd-navbar-next-icon></yd-navbar-next-icon>-->
        <!--</router-link>-->
        <!---->
    </yd-navbar>
    <div class="iconSty" @click="tiedCard"><span>我要绑卡</span><img slot="icon" class="cardIcon" src="images/tiedCard.png"></div>
    <div v-for="(item,index) in memberCard" :key="index">
        <div class='section_items' @click="chooseCard(index)">
            <img class="section_image" slot="img" src="images/card.png">
            <div class="section_cont">
                <div class='hid_contSty'>
                    <p class='hid_contStys'>卡号：</p>
                    <p class="width3">{{item.ICCardId}}</p>
                </div>
                <div class='hid_contSty'>
                    <p class='hid_contStys'>级别：</p>
                    <p>{{item.LevelName}}</p>
                </div>
                <div class='hid_contSty'>
                    <p class='hid_contStys'>到期日期：</p>
                    <p>{{item.EndDate}}</p>
                </div>
            </div>
            <div class="BuyCoins" @click.stop="topUp(index)">
                <p>流水账单</p>
            </div>
        </div>
        <!--<div class='hid_cont' v-if="item.hidden">-->
            <!--<div class="hid_contLeft">-->
                <!--<div class='hid_contSty'>-->
                    <!--<p class='hid_contStys'>币余额：</p>-->
                    <!--<p>{{item.balance}}</p>-->
                <!--</div>-->
                <!--<div class='hid_contSty'>-->
                    <!--<p class='hid_contStys'>彩票：</p>-->
                    <!--<p>{{item.lottery}}</p>-->
                <!--</div>-->
                <!--<div class='hid_contSty'>-->
                    <!--<p class='hid_contStys'>积分：</p>-->
                    <!--<p>{{item.point}}</p>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="hid_contLeft">-->
                <!--<div class='hid_contSty'>-->
                    <!--<p class='hid_contStys'>到期日期：</p>-->
                    <!--<p>{{item.endDate}}</p>-->
                <!--</div>-->
                <!--<div class='hid_contSty'>-->
                    <!--<p class='hid_contStys'>押金：</p>-->
                    <!--<p>{{item.deposit}}</p>-->
                <!--</div>-->
                <!--<yd-button @click.stop.native="laundryList(index)" size="small">流水账单</yd-button>-->
            <!--</div>-->
        <!--</div>-->
    </div>
    <!--<yd-tabbar fixed=true active-color="#000000">-->
        <!--<yd-tabbar-item title="首页" @click.native="register1">-->
            <!--<yd-icon name="home" slot="icon" size="0.54rem"></yd-icon>-->
        <!--</yd-tabbar-item>-->
        <!--<yd-tabbar-item title="我的订单" @click.native="register2">-->
            <!--<yd-icon name="shopcart" slot="icon" size="0.54rem"></yd-icon>-->
        <!--</yd-tabbar-item>-->
        <!--<yd-tabbar-item title="个人中心" @click.native="register3">-->
            <!--<yd-icon name="ucenter-outline" slot="icon" size="0.54rem"></yd-icon>-->
        <!--</yd-tabbar-item>-->
    <!--</yd-tabbar>-->
</div>

<!-- 引入 Vue -->
<script src="js/vue.js"></script>
<script src="js/jquery-1.8.3-min.js"></script>
<!-- 引入组件库 -->
<script src="js/ydui.rem.js"></script>
<script src="js/axios.min.js"></script>
<script>
    var sysId = 0; //调用方应用Id
    var versionNo= "0.01"; //版本号
    var vm = new Vue({
        el: '#app',
        data:{
            userThirdId:"",
            memberCard:null
        },
        mounted: function () {
            this.Load();
        },
        methods: {
            Load:function () {
                var that =this;
                var userThirdId = "oNWocwSC_GFO8n_8mtZ0iV9tL0WI";
//                var userThirdId = getStorage("userThirdId")||"";     //获取第三方令牌
                that.userThirdId = userThirdId;
                this.$dialog.loading.open('');
                var obj={
                    sysId: sysId,
                    versionNo: versionNo,
                    token: that.userThirdId
                };
                axios.post('/XCCloudH5/Member?action=getCardList', obj).then(function (res) {
                    that.$dialog.loading.close();
                    that.msgPrompt(res.data);
                    console.log(res.data);
                    if (res.data.result_code === '1') {
                        that.memberCard = res.data.result_data;
                        console.log(that.memberCard)
//                        for (var i = 0; i < res.data.result_data.length; i++) memberCard_.push({
//                            memberLevelName: res.data.result_data[i].MemberLevelName,
//                            mobile: res.data.result_data[i].Phone,
//                            endDate: res.data.result_data[i].EndTime,
//                            icCardID: res.data.result_data[i].ICCardID,
//                            storeId: res.data.result_data[i].StoreId,
//                            storeName: res.data.result_data[i].StoreName,
//                            memberToken: res.data.result_data[i].Token,
//                            hidden: false,
//                            balance: "",
//                            point: "",
//                            deposit: "",
//                            lottery: ""
//                        });
//                        that.memberCard = memberCard_;
//                        console.log(that.memberCard)
                    }
                }).catch(function (err) {
                    that.$dialog.loading.close();
                    console.log(err);
                })

            },
//          绑卡跳转
            tiedCard:function () {
                window.location.href = "tiedCard.html"
            },
//          选择卡
            chooseCard:function (index) {
                var that = this;
                var obj={
                    sysId: sysId,
                    versionNo: versionNo,
                    token: that.userThirdId,
                    cardId:that.memberCard[index].Id
                };
                axios.post('/XCCloudH5/Member?action=chooseCard', obj).then(function (res) {
                    that.$dialog.loading.close();
                    that.msgPrompt(res.data);
                    console.log(res.data);
                    if (res.data.result_code === '1') {
                        window.location.href = "index.html"
                    }
                }).catch(function (err) {
                    that.$dialog.loading.close();
                    console.log(err);
                })
            },
            msgPrompt:function (res) {
                if(res.return_code == 0){
                    this.$dialog.toast({
                        mes: res.return_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }else if(res.result_code == 0){
                    this.$dialog.toast({
                        mes: res.result_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }
            }
        }
    });
    //存储session
    function setStorage(key,value) {
        if(window.localStorage){
            value = JSON.stringify(value); //转化为JSON字符串
            var storage=window.localStorage;
            storage.setItem(key,value);
        }
    }
    //删除session
    function removeStorage(key) {
        if(window.localStorage){
            var storage=window.localStorage;
            storage.removeItem(key);
        }
    }
    //获取session
    function getStorage(key) {
        if(window.localStorage){
            value = JSON.parse(localStorage.getItem(key));
            return value;
        }
    }
</script>
</body>
</html>