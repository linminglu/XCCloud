<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>莘拍档</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/ydui.rem.css">
    <!-- 引入rem自适应类库 -->
    <style>
    </style>
</head>
<body>
    <div id="app">

    </div>
<!-- 引入 Vue -->
<script src="js/vue.js"></script>
<script src="js/jquery-1.8.3-min.js"></script>
<!-- 引入组件库 -->
<script src="js/ydui.rem.js"></script>
<script src="js/ydui.flexible.js"></script>

<script src="js/axios.min.js"></script>
<script>
    var sysId = 0; //调用方应用Id
    var versionNo= "0.89"; //版本号
    var chatHub;//定义TCP对象
    var htmlfnc = new Vue({
        el: '#app',
        data:{

        },
        mounted: function () {
            this.Load();
        },
        methods: {
            Load:function () {
                var that =this;
                chatHub = $.connection.XCGameClientHub;
                that.registerClientMethods(chatHub);
                // Start Hub
                $.connection.hub.start().done(function () {
                    chatHub.server.connect("034e5131f92e45b08fea1228ea43af57", "0");
                });
            },
            registerClientMethods:function(chatHub){//注册客户端方法
                var that =this;
                chatHub.client.broadcastMessage = function (name, message) {
                    //接受广播消息
                };
                chatHub.client.hubCall = function (data) {
                    console.log(data);
                        switch (data.callType) {
                            case "connect": that.callBackFnc2(data); break;
                            case "notify": that.callBackFnc(data); break;
                            default: break;
                        }
                };
            },
            callBackFnc: function (data) {
                this.msgPrompt(data);
                if(data.result_code == "1" && data.result_data.answerOjb.result_code == "1"){
                    this.$dialog.toast({
                        mes:data.result_data.answerOjb.answerMsg,
                        timeout: 1500,
                        icon: 'success'
                    });
                }
            },
            callBackFnc2: function (data) {
                this.msgPrompt(data);
                if(data.result_code != 1){
                    this.load();
                }
            },
            msgPrompt:function (res) {
                if(res.return_code == 0){
                    this.$dialog.toast({
                        mes: res.return_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }else if(res.result_code == 0){
                    this.$dialog.toast({
                        mes: res.result_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }
            }
        }
    });
    //存储session
    function setStorage(key,value) {
        if(window.localStorage){
            value = JSON.stringify(value); //转化为JSON字符串
            var storage=window.localStorage;
            storage.setItem(key,value);
        }
    }
    //删除session
    function removeStorage(key) {
        if(window.localStorage){
            var storage=window.localStorage;
            storage.removeItem(key);
        }
    }
    //获取session
    function getStorage(key) {
        if(window.localStorage){
            value = JSON.parse(localStorage.getItem(key));
            return value;
        }
    }
    $(function () {
        // Declare a proxy to reference the hub
    });
</script>

</body>
</html>