<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>莘拍档</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/ydui.rem.css">
    <!-- 引入rem自适应类库 -->

    <style>
        .hidden{display: none;}
        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <yd-tabbar fixed=true active-color="#000000">
        <yd-tabbar-item title="首页" active>
            <yd-icon name="home" slot="icon" size="0.54rem"></yd-icon>
        </yd-tabbar-item>
        <yd-tabbar-item title="我的订单" @click.native="register1">
            <yd-icon name="shopcart" slot="icon" size="0.54rem"></yd-icon>
        </yd-tabbar-item>
        <yd-tabbar-item title="个人中心" @click.native="register2">
            <yd-icon name="ucenter-outline" slot="icon" size="0.54rem"></yd-icon>
        </yd-tabbar-item>
    </yd-tabbar>
    <div style="height: 275px;">
        <yd-slider autoplay="3000" direction="vertical">
            <yd-slider-item v-for="item, key in banner" :key="item.ID">
                <a href="javaScript:void(0);">
                    <img :src="item.PicturePath"/>
                </a>
            </yd-slider-item>
        </yd-slider>
    </div>
    <yd-list theme="4">
        <yd-list-item v-for="item, key in newsList" :key="item.ID">
            <img slot="img" :src="item.PicturePath">
            <span slot="title">{{item.Title}}</span>
            <yd-list-other slot="other">
                <div>
                    <span class="demo-list-price"><em></em>{{item.StoreName}}</span>
                </div>
                <div><span class="demo-list-del-price">{{item.Time}}</span></div>
            </yd-list-other>
        </yd-list-item>
    </yd-list>
</div>

<!-- 引入 Vue -->
<script src="js/vue.js"></script>
<script src="js/ydui.flexible.js"></script>
<script src="js/jquery-1.8.3-min.js"></script>
<!-- 引入组件库 -->
<script src="js/ydui.rem.js"></script>
<script src="js/axios.min.js"></script>
<script>
    var sysId = 0; //调用方应用Id
    var versionNo= "0.89"; //版本号
    var url_getNews = '/api/XCGameMana/Promotion.ashx?action=getPromotion';   //首页news获取
    var htmlfnc = new Vue({
        el: '#app',
        data:{
            newsList:[],
            banner:[]
        },
        mounted: function () {
            this.Load();
        },
        methods: {
            Load: function () {
                var that =this;
                var deviceNo = getStorage("deviceNo")||"";
                console.log(deviceNo);
                if(deviceNo ==""){
                    var obj={"sysId": sysId ,"versionNo": versionNo};
                    this.$dialog.loading.open('');
                    axios.post(url_getNews, obj).then(function (res) {
                        console.log(res.data);
                        that.$dialog.loading.close();
                        that.msgPrompt(res.data);
                        if (res.data.result_code === '1') {
                            console.log(res.data.result_data.length);
                            var _newsList=[];
                            var _banner=[];
                            for (var i = 0; i < res.data.result_data.length; i++) {
                                console.log(res.data.result_data[i].PublishType);
                                if (res.data.result_data[i].PublishType == 0) {
                                    _newsList.push({
                                        ID: res.data.result_data[i].ID,
                                        PagePath: res.data.result_data[i].PagePath,
                                        PicturePath: res.data.result_data[i].PicturePath,
                                        PromotionType: res.data.result_data[i].PromotionType,
                                        ReleaseTime: res.data.result_data[i].ReleaseTime,
                                        StoreID: res.data.result_data[i].StoreID,
                                        StoreName: res.data.result_data[i].StoreName,
                                        Time: res.data.result_data[i].Time,
                                        Title: res.data.result_data[i].Title
                                    });
                                    console.log(_newsList);
                                }
                                else {
                                    _banner.push({
                                        ID: res.data.result_data[i].ID,
                                        PagePath: res.data.result_data[i].PagePath,
                                        PicturePath: res.data.result_data[i].PicturePath,
                                        PromotionType: res.data.result_data[i].PromotionType,
                                        ReleaseTime: res.data.result_data[i].ReleaseTime,
                                        StoreID: res.data.result_data[i].StoreID,
                                        StoreName: res.data.result_data[i].StoreName,
                                        Time: res.data.result_data[i].Time,
                                        Title: res.data.result_data[i].Title
                                    });
                                    console.log(_banner);
                                }
                            }
                            that.newsList =_newsList;
                            that.banner =_banner;
                        }
                    }).catch(function (err) {
                        console.log(err);
                        that.$dialog.loading.close();
                    })
                }else {
                    var obj={sysId: sysId, versionNo: versionNo, deviceToken:deviceNo};
                    axios.post('/xcgamemana/store?action=storeInfoByTerminalNo', obj).then(function (res) {
                        that.$dialog.loading.close();
                        that.msgPrompt(res.data);
                        console.log(res.data);
                        if (res.data.result_code === '1') {
                            setStorage("deviceToken",deviceNo);
                            removeStorage("deviceNo");
                            switch (res.data.result_data.deviceType) {
                                case "自助提币机":
                                    window.location.href = "CurrencyOperation.html";
                                    break;
                                case "自助存币机":
                                    window.location.href = "CurrencyOperation.html";
                                    break;
                                case "游戏机":
                                    window.location.href = "games.html";
                                    break;
                                default:
                                    break;
                            }
                        }
                    }).catch(function (err) {
                        that.$dialog.loading.close();
                        console.log(err);
                    });
                }

            },
            register1:function () {
                window.location.href = "MyOrder.html"
            },
            register2:function () {
                window.location.href = "mine.html"
            },
            msgPrompt:function (res) {
                if(res.return_code == 0){
                    this.$dialog.toast({
                        mes: res.return_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }else if(res.result_code == 0){
                    this.$dialog.toast({
                        mes: res.result_msg,
                        timeout: 1500,
                        icon: 'error'
                    });
                }
            }
        }
    });
    function setStorage(key,value) {
        if(window.localStorage){
            value = JSON.stringify(value); //转化为JSON字符串
            var storage=window.localStorage;
            storage.setItem(key,value);
        }
    }
    //删除session
    function removeStorage(key) {
        if(window.localStorage){
            var storage=window.localStorage;
            storage.removeItem(key);
        }
    }
    //获取session
    function getStorage(key,value) {
        if(window.localStorage){
            var storage=window.localStorage;
            value = JSON.parse(localStorage.getItem(key));
            return value;
        }
    }




</script>
</body>
</html>